% $Author: $ $Date: $
% $Header: $ $Name:  $
% $Revision: $
%

\documentclass[a4paper,11pt]{report}
\usepackage{latexsym,graphicx,multicol}
\usepackage[french]{babel}
\usepackage{wrapfig}
\title{ADAMA 0.1}
\author{\copyright~Copyright 2008, AdamaSoft.\\
   All rights reserved.}
\date{31 July 2008}
\begin{document}
\maketitle
\tableofcontents
\chapter{Introduction}
ADAMA est un logiciel multi-plateforme de recouvrement. Il se compose de plusieurs modules:
\begin{itemize}
\item le module d'administration d'ADAMA (adama\_admin)
\item le module des Charg\'es de Client\`ele (adama\_cdc)
\item le module d'interface d'ADAMA (import et export des donn\'ees)
\item le module de traitement des clients g\'er\'es par ADAMA (adamad)
\item un serveur tournant en t\^ache de fond pour traiter les clients devant quitter la relance afin de minimiser le temps d'attente du client dans le cas d'une r\'eactivation: \textsl{adama\_rollback}
\item le module de traitement de sortie des clients du recouvrement en temps r\'eel (adama\_rollbak)
\item une API C++ pour interfacer d'autres \'el\'ements logiciels \`a ADAMA: \textsl{AdamaAPI.hpp}
\end{itemize}

\section{Le module d'administration d'ADAMA}
Le module d'administration d'ADAMA autorise:
	\begin{itemize}
	\item la d\'efinition des cycles de recouvrement
	\item la d\'efinition des \'etapes de recouvrement
	\item la d\'efinition des conditions de changement d'\'etape
	\item la d\'efinition des actions associ\'ees aux \'etapes de recouvrement
%\item la gestion des droits d'utilisation des modules [NON IMPLEMENTE]
	\end{itemize}

Le moteur de traitement adamad est lanc\'e \`a partir d'une commande en ligne ou du module d'administration.

\section{Le module des Charg\'es de Client\`ele}
Le module des Charg\'es de Client\`ele (CDC) permet au CDC de:
	\begin{itemize}
	\item consulter les informations relatives au client: nom, pr\'enom, adresse, le montant initial d\^u du client, le montant restant d\^u du client
	\item consulter les contrats du client
	\item consulter les factures du client
	\item consulter les paiements du client
	\item consulter les p\'enalit\'es affect\'ees au client
	\item consulter l'\'etape courante du client
%\item \'etablir/modifier/supprimer des \'ech\'eanciers sur la facture d'un client [NON IMPLEMENTE]
	\end{itemize}

\section{Le module de traitement des clients g\'er\'es par ADAMA}
Le module de traitement consiste \`a faire \'evoluer chaque client dans le cycle de recouvrement auquel il est affect\'e.

\section{Le module d'interface d'ADAMA}
ADAMA d\'efinit un mode g\'en\'erique de fonctionnement. Il accepte en entr\'ee un ensemble d'items. De m\^eme, en sortie, ADAMA g\'en\'ere des ensembles d'items. Chaque item est compos\'e d'un ensemble d'\'el\'ements.

Le module d'import d'ADAMA importe dans le syst\`eme des items.
Le module d'export d'ADAMA exporte du syst\`eme des items.

Un exemple d'item est un client ou une facture ou encore un contrat. L'ensemble des items sont d\'efinis dans un fichier au format XML situ\'e dans le r\'epertoire \$ADAMA\_HOME/work/xsd.\\
Que ce soit l'import ou l'export, il existe 2 types de flux dans ADAMA:
\begin{itemize}
\item les flux par fichier XML
\item les flux par l'interm\'ediaire de webservices utilisant le protocole SOAP (http://www.w3.org/2000/xp/Group/2/03/soap1.2implementation.html)
\end{itemize}

%\section{Notions d'utilisateurs \& r\^oles}
%A chaque module est associ\'e un droit d'utilisation. Pour chaque utilisateur enregistr\'e dans ADAMA, il est possible d'accorder un droit d'utilisation pour un module particulier. [NON IMPLEMENTE] \\
%
\section{Traitements parall\`eles}
Afin d'am\'eliorer les performances logicielles, ADAMA d\'ecoupe les donn\'ees \`a traiter en groupes. Chaque groupe contient un certain nombre de clients \`a traiter en parall\`ele de mani\`ere \`a optimiser les traitements. L'administrateur d'ADAMA d\'etermine le nombre de groupes au lancement du serveur \textsl{adamad} ou par l'interface graphique \textsl{adama\_admin}.

\section{Architecture du logiciel}

\chapter{Installation d'ADAMA}
\section{Pr\'erequis}
ADAMA repose sur plusieurs logiciels:
\begin{itemize}
\item postgresql-8.3.0 (http://www.postgresql.org/)
\item libpqxx-2.6.9 (http://pqxx.org/development/libpqxx/wiki/DownloadPage)
\item Xerces-c\_2.7.0 (http://xerces.apache.org/)
\item Xalan-C++\_1.10 (http://xml.apache.org/xalan-c/)
\item Apache-2.2.4 (http://httpd.apache.org/)
\item wxwidgets-2.8.7 (http://www.wxwidgets.org/downloads/)
\item log4cxx (http://logging.apache.org/log4cxx/index.html)
\item Axis2/c-1.2.0 (http://ws.apache.org/axis2/c/) [ATTENTION: v\'erifier la version utilis\'ee, elle a pu chang\'ee]
\end{itemize}

Pour toutes les installations qui vont suivre, il est pratique de cr\'eer un r\'epertoire - software par exemple - pour d\'eposer toutes les archives t\'el\'echarg\'ees.

\paragraph{Installation de PostgreSQL}
R\'ecup\'erer l'archive postgresql-8.3.0.tar.bz2 du site http://www.postgresql.org. Puis appliquer les commandes suivantes:
\begin{verbatim}
tar xvjf postgresql-8.3.0.tar.bz2

cd postgresql-8.3.0/
./configure --enable-thread-safety
make
su <type root password>
make install
\end{verbatim}

Ajouter le chemin des librairies dans la variable d'environnement LD\_LIBRARY\_PATH
\begin{verbatim}
LD_LIBRARY_PATH=/usr/local/pgsql/lib:$LD_LIBRARY_PATH
\end{verbatim}

Ajouter le chemin des binaires dans la variable d'environnement PATH
\begin{verbatim}
PATH=/usr/local/pgsql/bin:$PATH
\end{verbatim}

\paragraph{Cr\'eation de l'environnement de fonctionnement de la base de donn\'ees}
Ces commandes sont r\'ealis\'ees avec l'utilisateur root.
\begin{verbatim}
adduser postgres
mkdir /usr/local/pgsql/data
chown postgres /usr/local/pgsql/data
su - postgres
/usr/local/pgsql/bin/initdb -D /usr/local/pgsql/data
/usr/local/pgsql/bin/postgres -D /usr/local/pgsql/data >logfile 2>&1 &
\end{verbatim}
Les commandes pr\'ec\'edentes cr\'eent l'utilisateur Unix \textsl{postgres} pour la gestion de postgresql. Le r\'epertoire /usr/local/pgsql/data contient les donn\'ees de fonctionnement de la base.
La derni\`ere commande lance le serveur. Elle peut \^etre int\'egr\'ee dans les scripts de d\'emarrage du syst\`eme Unix.

\paragraph{Cr\'eation de la base de donn\'ees pour ADAMA}
Supposons que l'administrateur souhaite cr\'eer la base adama\_prod appartenant \`a l'utilisateur adm\_adama (mot de passe: pwd\_adama) sous le compte Unix ada\_unix.
Pour faciliter les op\'erations de maintenance, modifier le fichier \textsl{pg\_hba.conf} dans le r\'epertoire /usr/local/pgsql/data. Cette op\'eration n\'ecessite de se logger avec l'utilisateur \textsl{posgtres}.
\begin{verbatim}
local	adama_prod	all	ident adama_prod
\end{verbatim}

Dans le m\^eme r\'epertoire, modifier le fichier \textsl{pg\_ident.conf}:
\begin{verbatim}
adama_prod	ada_unix	adm_adama
\end{verbatim}

Red\'emarrer le serveur postgresql pour prendre en compte les modifications de param\'etrage.

\section{Installation de libpqxx}
\begin{verbatim}
tar xvzf libpqxx-2.6.9.tar.gz
./configure --enable-shared
make
su <type root password>
make install
\end{verbatim}

\section{Installation de Xerces}
R\'ecup\'erer l'archive xerces-c-src\_2\_7\_0.tar.gz du site http://archive.apache.org/dist/xml/xerces-c/Xerces-C\_2\_7\_0/source/. Appliquer les commandes suivantes:
\begin{verbatim}
tar xvzf xerces-c-src_2_7_0.tar.gz 
cd xerces-c-src_2_7_0
export XERCESCROOT=`pwd`
cd src/xercesc
./runConfigure -p linux -c gcc -x g++ -r pthread -b 64  
make

cd $XERCESCROOT/samples/
./runConfigure -p linux -c gcc -x g++ -r pthread -b 64  
make
\end{verbatim}

La librairie libxerces-c.so.27.0 est dans le r\'epertoire \$XERCESCROOT/lib. Ajouter ce r\'epertoire dans la variable d'environnement LD\_LIBRARY\_PATH.
La variable d'environnement \$XERCESCROOT doit \^etre \'egalement d\'efinie dans le .profile de l'utilisateur.

\section{Installation de Xalan}
R\'ecup\'erer l'archive Xalan-C\_1\_10\_0-src.tar.gz du site http://apache.multidist.com/xml/xalan-c/. Les instructions d'installation sont \'egalement d\'ecrites \`a l'adresse suivante: http://xml.apache.org/xalan-c/build\_instruct.html\#unix.
La variable XERCESCROOT doit \^etre positionn\'ee.
Appliquer les commandes suivantes:
\begin{verbatim}
tar xvzf Xalan-C_1_10_0-src.tar.gz 
cd xml-xalan/c
export XALANCROOT=`pwd`
./runConfigure -p linux -c gcc -x g++ -b 64
su <type root password>
make

\end{verbatim}

La librairie libxalan-c.so.110.0 est dans le r\'epertoire /usr/local/lib. Ajouter ce r\'epertoire dans la variable d'environnement LD\_LIBRARY\_PATH.
La variable d'environnement \$XALANCROOT doit \^etre \'egalement d\'efinie dans le .profile de l'utilisateur.

\section{Installation de Apache}
\label{section:install_apache}
L'installation du serveur Apache est document\'ee sur le site http://www.apache.org.

\section{Installation de Axis2/c}
R\'ecup\'erer l'archive suivante http://apache.miroir-francais.fr/ws/axis2/c/1\_2\_0/axis2c-src-1.2.0.tar.gz. Les instructions d'installation sont \'egalement d\'ecrites \`a l'adresse suivante: http://ws.apache.org/axis2/c/docs/installationguide.html.
Dans les commandes qui suivent, Apache a \'et\'e install\'e dans /usr/local/apache2 :
\begin{verbatim}
tar xvzf axis2c-src-1.2.0.tar.gz 
export AXIS2C_HOME=/usr/local/axis2c/
cd axis2c-src-1.2.0/
./configure --with-apache2=/usr/local/apache2/include/ --with-apr=/usr/local/apache2/include/
make
su <type root password>
make install
\end{verbatim}

Cette installation cr\'ee le r\'epertoire /usr/local/axis2c.
Pour mettre en place les services Web d'ADAMA, cr\'eer le r\'epertoire /usr/local/axis2c/services/import\_customer/ puis copier le fichier ADAMA/conf/services.xml dans /usr/local/axis2c/services/import\_customer/.
Aller dans le r\'epertoire /usr/local/axis2c/services/import\_customer/ puis cr\'eer le lien vers la librairie ADAMA/lib/libimport\_customer.so
\begin{verbatim}
ln -s /home/simon/ADAMA/lib/libimport_customer.so libimport_customer.so 
\end{verbatim}

Copier la librairie libmod\_axis2.so dans le r\'epertoire des modules d'Apache:
\begin{verbatim}
cp $AXIS2C_HOME/lib/libmod_axis2.so.0.0.0 /usr/local/apache2/modules/mod_axis2.so
\end{verbatim}

Modifier le fichier /usr/local/apache2/conf/httpd.conf de la mani\`ere suivante:
\begin{verbatim}
Axis2RepoPath /usr/local/axis2c/
Axis2LogFile  /usr/local/axis2c/logs/axis2.log
Axis2LogLevel AXIS2_LOG_LEVEL_TRACE
  
LoadModule axis2_module modules/mod_axis2.so
  
<Location /axis2>
  	SetHandler axis2_module
</Location>
\end{verbatim}

Red\'emarrer le serveur Apache pour prendre en compte les modifications:
\begin{verbatim}
apachectl stop
apachectl start
\end{verbatim}

\section{Installation de wxWidgets}
R\'ecup\'erer l'archive suivante wxGTK-2.8.7.tar.gz du site http://www.wxwidgets.org/downloads/\#latest\_stable (wxGTK).
Appliquer les commandes suivantes:
\begin{verbatim}
tar xvzf wxGTK-2.8.7.tar.gz
cd wxGTK-2.8.7
mkdir build_gtk   <---- Creation d'un repertoire de compilation
cd build_gtk
../configure
make
su <type root password>
make install
ldconfig
\end{verbatim}

\section{Installation de log4cxx}
L'installation des packages apr et apr-util sont n\'ecessaires pour log4cxx.

\paragraph{Installation de apr-1.2.12}
\begin{verbatim}
./configure 
make
make install
\end{verbatim}

\paragraph{Installation de apr-util-1.2.12}
\begin{verbatim}
./configure
make
make install
\end{verbatim}

\paragraph{Installation de ant-contrib + cpptasks}
\begin{verbatim}
cd ${SOFTWARE_HOME}
svn co http://ant-contrib.svn.sourceforge.net/svnroot/ant-contrib ant-contrib

cd ant-contrib/ant-contrib/trunk

ant

cd ../../cpptasks/trunk

ant
\end{verbatim}

\paragraph{Installation de log4cxx}
\begin{verbatim}
export CLASSPATH=${SOFTWARE_HOME}/ant-contrib/ant-contrib/trunk/target/ant-contrib.jar:${SOFTWARE_HOME}/ant-contrib/cpptasks/trunk/target/lib/cpptasks.jar

ant -Dwith-apr=/home/software/apr-1.2.12 -Dwith-apr-util=/home/software/apr-util-1.2.12 -Dapr.lib.dir=/usr/local/apr/lib/ -Dapr-util.lib.dir=/usr/local/apr/lib/ build

su -
cd /usr/local/lib/
ln -s /home/software/apache-log4cxx/target/debug/shared/liblog4cxx.so liblog4cxx.so
\end{verbatim}

\section{Installation d'ADAMA}
\begin{verbatim}
tar xvzf adama_v1.0.tar.gz
\end{verbatim}

Il n'est pas n\'ecessaire d'\^etre l'utilisateur root pour l'installation.
Aller dans le r\'epertoire o\`u est d\'epos\'ee l'archive contenant ADAMA:  \textsl{adama\_v1.0.tar.gz}.
Pour d\'esarchiver l'archive, executer la commande suivante:
\begin{verbatim}
tar xvzf adama_v1.0.tar.gz
\end{verbatim}

Cette commande cr\'ee le r\'epertoire ADAMA et l'arborescence de travail (cf. paragraphe~\ref{paragraph:actions}).

\begin{verbatim}
ADAMA
|-- bin
|-- conf
|-- lib
|-- work
    |-- xsd
    |-- xsl
\end{verbatim}

\paragraph{Cr\'eation de la base de donn\'ees pour ADAMA}
Pour cr\'eer la base de donn\'ees n\'ecessaire au fonctionnement d'ADAMA, aller dans le r\'epertoire shl puis lancer la s\'erie de commandes suivantes:
\begin{verbatim}
bash-3.00$ creation_db.ksh
Entrer le nom de la base de donnees:
adama_prod
Entrer le nom de l'utilisateur de la base de donnees:
adm_adama
Entrer le mot de passe de l'utilisateur de la base de donnees:
Confirmer le mot de passe de l'utilisateur de la base de donnees:
 L'eventuelle base de donnees adama_prod va etre detruite.
 Souhaitez-vous continuer (o/n) ?
o
Le mot de passe du user postgres va vous etre demande pour supprimer l'eventuelle base adama_prod
Password:
Le mot de passe du user postgres va vous etre demande pour supprimer l'utilisateur de la base ADAMA
Password:
Le mot de passe du user postgres va vous etre demande pour creer l'utilisateur de la base ADAMA
Password:
Le mot de passe du user postgres va vous etre demande pour creer la base adama_prod
Password:
OK no error...
\end{verbatim}

\section{V\'erification de l'installation}
Avec un navigateur, consulter l'URL suivante: http://localhost:8080/axis2/services/
Les services suivants s'affichent entre autres:
\begin{verbatim}
import_customer

This is a service to import customer, contract, payment, invoice into ADAMA
Available Operations

    * update_customer_optest
    * import_invoice_optest
    * import_contract_optest
    * import_payment_optest
    * commit_customer_optest
    * import_customer_optest
    * update_invoice_optest
    * update_contract_optest
\end{verbatim}

Pour v\'erifier que toutes les librairies sont op\'erationnelles, lancer la commande suivante dans \$ADAMA\_HOME:
\begin{verbatim}
./configure --enable-shared --enable-debug --disable-buildsource
\end{verbatim}

Si aucune erreur n'est remont\'ee, l'environnement est pr\^et.

\chapter{Architecture logicielle du module d'administration}
L'ensemble des traitements du logiciel sont ordonnanc\'es par un process serveur en t\^ache de fond \textsl{adamad}. \textsl{adamad} est configurable par l'interm\'ediaire du fichier \$ADAMA\_HOME/conf/adamad.conf. Il est n\'ecessaire de lancer \textsl{adamad} avant tout traitement\label{chap:this}.

\section{Lancement du serveur \textsl{adamad}}
\label{sec:lancement_adamad}
Pour lancer le serveur, aller dans le r\'epertoire contenant les binaires:
\begin{verbatim}
cd $ADAMA_HOME/bin
\end{verbatim}

Pour lancer le serveur, taper la commande:
\begin{verbatim}
adamad &
\end{verbatim}

Pour arr\^eter le serveur, taper la commande:
\begin{verbatim}
adamad_stop &
\end{verbatim}

\paragraph{Remarque} La liste des bases sur lesquelles les utilisateurs peuvent se connecter est dans le fichier \$ADAMA\_HOME/conf/cdc.ini (variable DBLISTS). Cette variable contient les noms des bases s\'epar\'ees par un espace.

Le serveur attend que tous les process en cours de traitement (adama\_engine ou adama\_import) soient arr\^et\'es avant de s'arr\^eter. Durant la phase d'arr\^et, il ne d\'emarre plus aucun nouveau process jusqu'au prochain lancement.

\section{Lancement du module pour le charg\'e de client\`ele}
Pour lancer le module d'administration, taper la commande:
\begin{verbatim}
adama_cdc &
\end{verbatim}

\section{Lancement du module d'administration}
Pour lancer le module d'administration, taper la commande:
\begin{verbatim}
adama_admin &
\end{verbatim}

Au lancement du module d'administration, celui-ci charge la table ADAMA\_CONFIG contenant un ensemble de param\`etres configurant le comportement d'ADAMA.

Entrer le login, le mot de passe et la base ADAMA administr\'ee:

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.5\textwidth]{/home/simon/ADAMA/Documentation/image/adama_connection.eps}
\end{center}
\end{figure}

\section{Description du module graphique d'administration d'ADAMA}
L'interface graphique d'administration pr\'esente les onglets suivants:
\begin{itemize}
\item Cycles: affichage des cycles de relance et des \'etapes qui les composent
\item Steps: toutes les \'etapes composant les cycles
\item Actions: actions appliqu\'ees aux items de dunning d\'eclench\'es \`a l'entr\'ee d'une \'etape
\item Engine : fen\^etre de lancement et d'arr\^et du d\'emon adamad, lancement et arr\^et du moteur de traitement adama\_engine, d\'etermination du nombre de paquets de clients \`a traiter
\item Import : gestion des items import\'es
\item Conditions : les conditions d'admission \`a une \'etape
\item Action Reverse : les actions de sortie de la relance
\item Function : les fonctions associ\'ees aux actions (cf. ~\ref{sec:adama_function})
\end{itemize}

\subsection{D\'efinition des cycles de recouvrement}
\label{sec:par3} Un cycle de recouvrement est la s\'equence des \'etapes de recouvrement que traverse un item de recouvrement (client, facture, contrat, \ldots) et les actions d\'eclench\'ees pendant la s\'equence.

L'ensemble des cycles de recouvrement sont dans la table CYCLES. Chaque cycle se caract\'erise par l'\'etape initiale \`a laquelle il est attach\'e.

\subsection{Affichage des cycles de relance}
L'onglet cycles de la figure ~\ref{sec:onglet_cycle} contient 2 fen\^etres:
\begin{itemize}
\item la $1^\mathrm{\grave{e}re}$ fen\^etre contient les cycles de relance sous forme de branche d'arbre, leurs \'etapes associ\'ees et leurs actions sous forme de feuilles.
\item la $2^\mathrm{\grave{e}me}$ fen\^etre contient un sch\'ema du cycle s\'electionn\'e dans la fen\^etre Cycles indiquant l'encha\^inement des \'etapes (rectangles bleus) ainsi que les conditions d'admission associ\'ees (cercles bleus).
\end{itemize}

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/adama_onglet_cycle.eps}
\caption{Onglet des cycles} \label{sec:onglet_cycle}
\end{center}
\end{figure}

\begin{figure}[!htb]
\centering
\begin{minipage}[t]{0.33\linewidth}
\centering
\includegraphics{/home/simon/ADAMA/Documentation/image/adama_cycles.eps}
\caption{Repr\'esentation d'un cycle}
\end{minipage}
\hspace{1cm}
\begin{minipage}[t]{0.33\linewidth}
\centering
\includegraphics{/home/simon/ADAMA/Documentation/image/adama_steps.eps}
\caption{Repr\'esentation d'une \'etape}
\end{minipage}
\hspace{1cm}
\begin{minipage}[t]{0.33\linewidth}
\centering
\includegraphics{/home/simon/ADAMA/Documentation/image/adama_action.eps}
\caption{Repr\'esentation d'une action}
\end{minipage}
\end{figure}

\subsection{Ajout d'un cycle de relance}
Pour ajouter un cycle de relance, aller dans le menu Edit $>$ Cycle $>$ Add. La fen\^etre de la figure ~\ref{sec:add_cycle} appara\^it.
\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/add_cycle.eps}
\caption{Ajout d'un cycle de relance} \label{sec:add_cycle}
\end{center}
\end{figure}

Renseigner les champs \textsl{Short Desc., Cycle Name}.
S\'electionner:
\begin{itemize}
\item l'\'etape initiale du cycle
\end{itemize}

Appuyer sur le bouton OK pour passer \`a la fen\^etre suivante. Confirmer ou annuler les modifications. Pour visualiser le nouveau cycle, appuyer sur le bouton Refresh.

\subsection{Affichage des \'etapes de relance}
\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/adama_onglet_steps.eps}
\caption{Onglet des \'etapes} \label{sec:onglet_steps}
\end{center}
\end{figure}

Les \'etapes sont affich\'ees ainsi que leurs caract\'eristiques (cf. figure ~\ref{sec:onglet_steps}):
\begin{itemize}
\item un code descripteur court 
\item le libell\'e de l'\'etape
\item la dur\'ee de l'\'etape en nombre de jours
\item le statut de l'\'etape: Active ou Inactive
\item le code descripteur court de l'\'etape pr\'ec\'edente
\item la priorit\'e de l'\'etape. Entre 2 \'etapes suivantes, celle qui a la plus basse priorit\'e est s\'electionn\'ee
\item la phase de l'\'etape: initiale, finale, au milieu (du cycle), parking. La phase parking est une phase qui indique que le client est sortie de la relance.
\item l'\'etape pr\'ec\'edente
\item la condition d'admission \`a l'\'etape
\item l'ensemble des actions associ\'ees
\end{itemize}

\subsection{Ajout d'une \'etape de relance}
Pour ajouter une \'etape de relance, aller dans le menu Edit $>$  Step $>$ Add. La fen\^etre qui appara\^it est semblable \`a la figure ~\ref{sec:add_step} \`a la diff\'erence que les champs \textsl{Short Desc.}, \textsl{Description}, \textsl{Status} sont vides.
\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/add_step.eps}
\caption{Ajout ou modification d'une \'etape} \label{sec:add_step}
\end{center}
\end{figure}

Renseigner les champs \textsl{Short Desc., Description, Status}.
S\'electionner:
\begin{itemize}
\item la phase de l'\'etape.
\item la priorit\'e 
\item la dur\'ee en jours
\item le statut. Une \'etape inactive n'est pas s\'electionn\'ee pour \^etre la prochaine \'etape d'un cycle
\item Pour les \'etapes situ\'ees en cours de cycle, choisir l'\'etape pr\'ec\'edente dans la rubrique \textsl{Prev. Step}
\item Choisir une ou plusieurs actions appliqu\'ees en cas d'acc\`es \`a l'\'etape dans la rubrique \textsl{Action List}
\item Choisir une ou aucune condition d'acc\`es \`a l'\'etape dans la rubrique \textsl{Condition Admission}
\end{itemize}

Appuyer sur le bouton OK pour passer \`a la fen\^etre suivante. Confirmer ou annuler les modifications. Si l'administrateur valide ses modifications, la fen\^etre ~\ref{sec:add_step_action_seq} s'affiche pour d\'eterminer l'ordre d'application des actions. Les actions ayant le m\^eme num\'ero de s\'equence sont r\'ealis\'ees de fa{\c c}on al\'eatoire une fois leur tour arriv\'e.
\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/add_step_action_seq.eps}
\caption{S\'equencement des actions} \label{sec:add_step_action_seq}
\end{center}
\end{figure}

\subsection{Modification des \'etapes de relance}
En double-cliquant sur l'un des enregistrements, une fen\^etre appara\^it afin de modifier l'\'etape (cf. figure ~\ref{sec:add_step}). La modification se d\'eroule de la m\^eme fa{\c c}on que la cr\'eation d'\'etape.

\subsection{D\'efinition des actions de recouvrement}
\label{sec:par5}
L'ensemble des actions de recouvrement sont dans la table ACTIONS.
Le traitement des fonctions associ\'ees \`a une action par l'interm\'ediaire de la table ACTIONS\_FUNCTIONS a lieu en une seule transaction c'est \`a dire que l'op\'eration de commit n'a lieu qu'\`a la fin du traitement de toutes les fonctions associ\'ees.

%%La liste des types manipul\'es par ADAMA est d\'efinie au paragraphe~\ref{subsection:types}.
	
\subsection{Affichage des actions}
L'onglet des actions \`a la figure ~\ref{sec:onglet_actions} contient les actions de relance disponibles.
\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/adama_onglet_actions.eps}
\caption{Onglet des actions} \label{sec:onglet_actions}
\end{center}
\end{figure}

En double-cliquant sur l'un des enregistrements, une fen\^etre appara\^it afin de modifier ou tester l'action. (cf. figure ~\ref{sec:add_action})

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/add_action.eps}
\caption{Ajout d'une action} \label{sec:add_action}
\end{center}
\end{figure}

Les actions sont affich\'ees ainsi que leurs caract\'eristiques (cf.figure ~\ref{sec:onglet_actions}):
\begin{itemize}
\item un code descripteur court 
\item le libell\'e de l'action
\item la p\'eriodicit\'e de l'action:
	\begin{itemize}
	\item une fois
	\item tous les n jours
	\item tous les n mois
	\item toutes les n ann\'ees
	\end{itemize}
Dans la version 0.1, ADAMA g\`ere les actions ponctuelles (une fois).
\item la fonction associ\'ee \`a l'action. Elles sont du type:
	\begin{itemize}
	\item STORED PROCEDURE: Dans ce cas, ADAMA appelle la proc\'edure stock\'ee dans PostgreSQL et l'ex\'ecute avec l'identifiant du client en argument.
	\item EXPORT: ADAMA g\'en\`ere un fichier XML contenant le r\'esultat de la requ\^ete d\'efinie dans la table EXPORT.body (cf. ~\ref{sec:description_export})
	\item TICKLER: Les ticklers ou notes de services sont des messages destin\'es aux charg\'es de client\`ele consultables dans le module du CDC adama\_cdc (cf. ~\ref{sec:description_tickler})
	\item SOAP STREAM OUT: Un message SOAP contenant le r\'esultant de la requ\^ete d\'efinie dans la table SOAP\_OUT\_STREAMS.body (cf. ~\ref{sec:description_soap}) 
	\end{itemize}
\item le type d'action. Cette notion n'est valable que dans le cas o\`u l'action est une action de sortie de recouvrement ( ACTIONS.is\_reverse\_action = true). Les types d'action de sortie de recouvrement sont:
	\begin{itemize}
	\item Accumulative (cf.~\ref{sec:description_traitements}). Dans ce cas, lorsque cette action est associ\'ee \`a l'action de recouvrement courante (table REVERSE\_ACTIONS), elle s'ajoute aux autres actions d'annulation dans la table REVERSE\_CUSTOMER\_PATH.
	\item Exclusive. Dans ce cas, elle annule toutes les actions d'annulation non r\'ealis\'ees dans la table REVERSE\_CUSTOMER\_PATH et devient l'action d'annulation r\'ealis\'ee en cas de sortie de recouvrement. Les liens entre les actions et les actions d'annulation sont d\'ecrits dans l'onglet \textsl{Reverse Actions} \`a la figure [INDIQUER LA FIG]
	\end{itemize}
\item Obligatoire ou facultative. Si une action est obligatoire, le client ne change d'\'etape que si cette action est r\'ealis\'ee. (Rubrique: \textsl{Mandatory})
\item Action d'annulation (ou de sortie de recouvrement) (Rubrique: \textsl{Reverse})
\item URL des exports ou des flux SOAP. Pour les exports, cette colonne indique le r\'epertoire et le pr\'efixe du nom du fichier g\'en\'er\'e par l'export. Pour les flux SOAP, elle indique l'adresse URL cible du flux SOAP.
\end{itemize}

\subsection{Ajout d'une action}
Pour ajouter une action, aller dans le menu Edit $>$ Action $>$ Add. Une fen\^etre semblable \`a la figure ~\ref{sec:add_action} appara\^it.

\subsection{Affichage des fonctions}
\label{sec:adama_function} Chaque action est associ\'ee \`a une fonction. Les fonctions disponibles d'ADAMA sont \'enum\'er\'ees dans l'onglet Function (cf. figure ~\ref{sec:adama_function}). Les types de fonctions existantes sont:
\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/adama_function.eps}
\caption{Onglet des fonctions} \label{sec:adama_function}
\end{center}
\end{figure}
L'onglet Function contient 2 rubriques:
\begin{itemize}
\item les fonctions d'export, de proc\'edure stock\'ee ou de flux SOAP
\item la fonction des ticklers
\end{itemize}

\begin{itemize}
\item l'export (stock\'es dans la table EXPORT)
\item le flux SOAP (stock\'es dans la table SOAP\_OUT\_STREAMS)
\item l'appel \`a une proc\'edure stock\'ee (stock\'es dans la table PROC\_STOCK)
\item le tickler (stock\'es dans la table TICKLERS)
\end{itemize}

Le tickler a une particularit\'e par rapport aux autres fonctions: une liste d'adresses e-mails est associ\'ee au tickler.
Pour les versions futures d'ADAMA, le tickler pourra\^it \^etre envoy\'e sous forme d'e-mail au charg\'e de client\`ele.
Pour ajouter une fonction, utiliser le menu Edit $>$ Function $>$ Add Function ou Add Tickler. Pour modifier une fonction, double-cliquer sur la ligne de la fonction dans l'onglet Functions, la fen\^etre de la figure ~\ref{sec:add_function} appara\^it.
\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/adama_add_function.eps}
\caption{Ajout ou modification d'une fonction} \label{sec:add_function}
\end{center}
\end{figure}

Pour les ticklers, la fen\^etre de la figure ~\ref{sec:add_tickler} appara\^it.
\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/adama_add_tickler.eps}
\caption{Ajout ou modification d'un tickler} \label{sec:add_tickler}
\end{center}
\end{figure}

\subsubsection{Description d'une fonction}
Les caract\'eristiques d'une fonction sont:
\begin{itemize}
\item le descripteur court
\item une description
\item la version de la fonction. Chaque fonction a une version et une date de validit\'e (au format DD/MM/YYYY) de la version. Pour l'instant, ces informations sont stock\'ees dans les tables mais n'ont pas de r\^ole fonctionnel
\item le type de fonction (export, proc\'edure stock\'ee \ldots)
\item le corps de la fonction
	\begin{itemize}
	\item dans le cas d'une proc\'edure stock\'ee, le corps de la fonction correspond au code de la proc\'edure stock\'ee. Parce qu'il est directement stock\'e et compil\'e en base, le code de la proc\'edure n'est pas charg\'e ni test\'e \`a l'ex\'ecution.
	\item dans le cas d'un export, d'un flux SOAP ou d'un tickler, le corps est d\'ecrit au paragraphe ~\ref{sec:structure_export}
	\end{itemize}
\end{itemize}

A l'ajout ou la modification d'une fonction, la requ\^ete stock\'ee dans le message XML est test\'ee \`a partir du bouton \textsl{Test}. Lorsque l'utilisateur appuie sur le bouton Test, une fen\^etre appara\^it et demande une r\'ef\'erence de client. Cette r\'ef\'erence sert \`a \'evaluer les param\`etres de la fonction puis \`a \'evaluer la fonction.

\paragraph{Remarque} Le test d'une fonction n\'ecessite au minimum la pr\'esence d'un client en base.

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/action_test.eps}
\caption{Test d'un export} \label{sec:action_test}
\end{center}
\end{figure}

Dans la fen\^etre de la figure ~\ref{sec:action_test}, le bouton Edit autorise la modification du corps de la fonction. En appuyant sur Load, la modification est sauvegard\'ee en base puis test\'ee.

\subsection{Structure g\'en\'erique d'un corps d'export, de flux SOAP ou de tickler}
\label{sec:structure_export} La requ\^ete contenue dans EXPORT.body, SOAP\_OUT\_STREAMS.body ou TICKLERS.content a 2 \'el\'ements XML de type particulier:
\begin{itemize}
\item tout \'el\'ement XML ayant l'attribut \textsl{key} avec la valeur \textsl{"pattern"}. Dans ce cas, la requ\^ete SQL contenue dans l'\'el\'ement \textsl{request} qui suit ne doit renvoyer qu'un seul enregistrement pour un triplet d'arguments. Si plus d'un enregistrement est renvoy\'e, ADAMA remonte une erreur et passe au traitement du client suivant. On appellera par la suite cet \'el\'ement le noeud pattern.
\item tout \'el\'ement XML ayant l'attribut \textsl{key} avec une valeur autre que \textsl{"pattern"}, alors l'\'el\'ement XML marqu\'e par cet attribut est consid\'er\'e comme un noeud fils du noeud marqu\'e par l'attribut \textsl{"pattern"}.
\end{itemize}

\paragraph{Remarque:} 
\begin{itemize}
\item La version 0.1 d'ADAMA a \'et\'e test\'e avec:
	\begin{itemize}
	\item un noeud tel que key="pattern"
	\item un ou plusieurs noeuds fils du noeud pattern
	\end{itemize}
\item Certains carac\`etres du corps de l'export doivent respecter le format XML. Notamment, le caract\`ere apostrophe \textsl{\&apos;}, les caract\`eres accentu\'es \ldots
\end{itemize}

Chaque noeud - pattern ou non - a la structure suivante:
\begin{itemize}
\item un \'el\'ement \textsl{request}. L'\'el\'ement \textsl{request} a les sous-\'el\'ements suivants:
	\begin{itemize}
	\item \textsl{sql} et \textsl{arg}: Ils contiennent la requ\^ete SQL et ses arguments. (cf. ~\ref{sec:exemple_sql})
	\item \textsl{result}: Il contient les \'el\'ements XML fils du noeud ayant l'attribut key. Chacun de ces \'el\'ements aura pour valeur dans l'ordre d'apparition la valeur de la colonne remont\'ee par la requ\^ete SQL. Le $1^\mathrm{er}$ \'el\'ement XML aura pour valeur la $1^\mathrm{\grave{e}re}$ colonne de la requ\^ete SQL \ldots
	\end{itemize}
\end{itemize}

Pour synth\'etiser,
\begin{verbatim}
<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- elements XML quelconques -->
<element_name_pattern key="pattern">
<request>
<sql>requete SQL</sql><arg/><sql> requete SQL</sql><arg/><sql> requete SQL</sql> <--- requete SQL avec n colonnes
<result>
<element_resultat_1/><element_resultat_2/>...<element_resultat_n/>
</result>
</request>
<element_name_nonpattern_1 key="nonnull">
<request>
<sql>requete SQL</sql><arg/><sql> requete SQL</sql><arg/><sql> requete SQL</sql> <--- requete SQL avec n1 colonnes
<result>
<element_resultat_1/><element_resultat_2/>...<element_resultat_n1/>
</result>
</request>
</element_name_nonpattern_1>
<element_name_nonpattern_2 key="nonnull">
<request>
<sql>requete SQL</sql><arg/><sql> requete SQL</sql><arg/><sql> requete SQL</sql> <--- requete SQL avec n2 colonnes
<result>
<element_resultat_1/><element_resultat_2/>...<element_resultat_n2/>
</result>
</request>
</element_name_nonpattern_2>
</element_name_pattern>
<!-- elements XML quelconques -->
\end{verbatim}

\subsection{Structure g\'en\'erique des arguments d'export, de flux SOAP ou de tickler}
Les arguments d'un corps d'export, de flux SOAP ou de tickler est un document XML qui contient une requ\^ete SQL. Les valeurs des colonnes de la requ\^ete sont affect\'ees aux \'el\'ements \textsl{arg} du corps d'export associ\'e.
Les \'el\'ements de l'argument sont:
\begin{itemize}
\item \textsl{build\_args}
\item \textsl{sql} ou \textsl{arg}: Ils contiennent la requ\^ete SQL et ses arguments. L'\'el\'ement \textsl{arg} vaut l'identifiant du client customer\_id (cf. ~\ref{sec:exemple_sql})
\end{itemize}

\subsection{Exemple d'un corps d'export ou de flux SOAP}
Voici un exemple d'export XML. La requ\^ete SQL est contenue dans l'\'el\'ement \textsl{request} est \'egale \`a la concat\'enation de tous les \'el\'ements sql (pour un \'el\'ement \textsl{request}).
\begin{verbatim}
<?xml version="1.0" encoding="ISO-8859-1"?>
<letter_exp>
<letter key="pattern">
<request>
<sql>select a.contract_id,a.contract_id,a.resource_number,a.entry_date from contract_resources a, contract b where b.contract_id=a.contract_id and b.customer_id=</sql><arg/><sql> and b.contract_id=</sql><arg/><sql>  and a.seq=(select max(seq) from contract_resources a1 where a1.contract_id = a.contract_id) and b.contract_seq = (select max(contract_seq) from contract b1 where b1.contract_id = b.contract_id)</sql>
<result>
<customer_id/><co_id/><ndi/><date_res/>
</result>
</request>
<invoice key="nonnull">
<request>
<sql>select invoice_ref,initial_open_amount from invoice where customer_id=</sql><arg/>
<result>
<invoice_ref/><initial_open_amount/>
</result>
</request>
</invoice>
</letter>
</letter_exp>
\end{verbatim}

\label{sec:exemple_sql} Dans l'exemple ci-dessus, les 2 requ\^etes SQL sont:
\begin{verbatim}
select a.contract_id,a.contract_id,a.resource_number,a.entry_date from contract_resources a, contract b where b.contract_id=a.contract_id and b.customer_id=<arg/> and b.contract_id=<arg/> and a.seq=(select max(seq) from contract_resources a1 where a1.contract_id = a.contract_id) and b.contract_seq = (select max(contract_seq) from contract b1 where b1.contract_id = b.contract_id)
\end{verbatim}
et
\begin{verbatim}
select invoice_ref,initial_open_amount from invoice where customer_id=<arg/>
\end{verbatim}

Les 2 requ\^etes pr\'ec\'edentes n\'ecessitent 3 arguments (\'el\'ement XML \textsl{arg}). La valeur des 3 arguments est fournie par l'\'evaluation de la requ\^ete contenue dans EXPORT.parameters, SOAP\_OUT\_STREAMS.parameters ou TICKLERS.parameters. 
\begin{verbatim}
<?xml version="1.0" encoding="UTF-8"?>
<build_args>
<sql>select customer_id, contract_id, customer_id from contract a where customer_id=</sql> <arg/><sql> and contract_seq=(select max(contract_seq) from contract a1 where a.contract_id = a1.contract_id)</sql>
</build_args>
\end{verbatim}

La requ\^ete pr\'ec\'edente qui fournit les arguments utilise automatiquement l'identifiant du client (customer\_id) \`a l'\'evaluation. Elle produit des triplets de la forme (customer\_id, contract\_id, customer\_id).
Chacun de ces triplets est fourni en argument aux 2 requ\^etes pr\'ec\'edentes qui sont \'evalu\'ees autant de fois qu'il ya de triplets.
\begin{itemize}
\item La $1^\mathrm{\grave{e}re}$ occurrence de arg est \'evalu\'ee avec customer\_id.
\item La $2^\mathrm{nde}$ occurrence de arg est \'evalu\'ee avec contract\_id.
\item La $3^\mathrm{\grave{e}me}$ occurrence de arg est \'evalu\'ee avec customer\_id.
\end{itemize}

En base, le client d'identifiant customer\_id=1 poss\`ede 3 contrats ayant respectivement l'identifiant et ndi (1, +33147300001), (2, +33147300001), (3, +33147300002).
En outre, le client a \'egalement les 3 factures en relances suivantes:
\begin{itemize}
\item INREFID775AD41
\item INREFID775AD42
\item INREFID775AD43
\end{itemize}

Ce qui produit - par exemple - le document XML suivant:
\begin{verbatim}
<?xml version="1.0" encoding="ISO-8859-1" standalone="no" ?>
<letter_exp>

  <letter key="pattern">
    <customer_id>1</customer_id>
    <co_id>1</co_id>
    <ndi>+33147300001</ndi>
    <date_res>2008-03-28 09:53:55.952994</date_res>

    <invoice key="nonnull">
      <invoice_ref>INREFID775AD42</invoice_ref>
      <initial_open_amount>23.5</initial_open_amount>
      <invoice_ref>INREFID775AD41</invoice_ref>
      <initial_open_amount>20.5</initial_open_amount>
      <invoice_ref>INREFID775AD43</invoice_ref>
      <initial_open_amount>20.5</initial_open_amount>

    </invoice>
  </letter>

  <letter key="pattern">
    <customer_id>2</customer_id>
    <co_id>2</co_id>
    <ndi>+33147300001</ndi>
    <date_res>2008-03-28 09:53:57.310028</date_res>

    <invoice key="nonnull">
      <invoice_ref>INREFID775AD42</invoice_ref>
      <initial_open_amount>23.5</initial_open_amount>
      <invoice_ref>INREFID775AD41</invoice_ref>
      <initial_open_amount>20.5</initial_open_amount>
      <invoice_ref>INREFID775AD43</invoice_ref>
      <initial_open_amount>20.5</initial_open_amount>

    </invoice>
  </letter>

  <letter key="pattern">
    <customer_id>3</customer_id>
    <co_id>3</co_id>
    <ndi>+33147300002</ndi>
    <date_res>2008-03-28 09:53:57.540915</date_res>

    <invoice key="nonnull">
      <invoice_ref>INREFID775AD42</invoice_ref>
      <initial_open_amount>23.5</initial_open_amount>
      <invoice_ref>INREFID775AD41</invoice_ref>
      <initial_open_amount>20.5</initial_open_amount>
      <invoice_ref>INREFID775AD43</invoice_ref>
      <initial_open_amount>20.5</initial_open_amount>

    </invoice>
  </letter>

</letter_exp>
\end{verbatim}

\subsection{Exemple de param\`etres pour un corps d'export ou de flux SOAP}
\begin{verbatim}
<?xml version="1.0" encoding="UTF-8"?>
<build_args>
<sql>select customer_id, contract_id, customer_id from contract a where customer_id=</sql> <arg/><sql> and contract_seq=(select max(contract_seq) from contract a1 where a.contract_id = a1.contract_id)</sql>
</build_args>
\end{verbatim}

\section{D\'efinition des cat\'egories de client}
\label{sec:par1} Une cat\'egorie de client se d\'efinit par:
\begin{itemize}
\item le nom de la cat\'egorie
\item le type de client
\end{itemize}
Les cat\'egories des clients sont param\'etr\'ees dans CUSTOMER\_CATEGORY.

\section{D\'efinition des conditions d'admission dans une \'etape de recouvrement}
Une condition d'admission \`a une \'etape est un ensemble de requ\^etes SQL qui renvoient des bool\'eens li\'ees par des $<$and$>$ ou $<$or$>$. Adama \'evalue chacune des requ\^etes puis \'evalue l'expression logique obtenue. Si le r\'esultat \textsl{true} est obtenue, la condition est v\'erifi\'ee, sinon elle ne l'est pas.
Dans le cas o\`u la description d'une condition est vide, elle est toujours vraie.

\subsection{Structure g\'en\'erique d'un corps de condition}
Le corps de la condition stock\'ee dans CONDITIONS.condition\_desc est d\'efini par une DTD dans le fichier condition.dtd. La DTD est:
\begin{verbatim}
<!ELEMENT arg (#PCDATA)>
<!ELEMENT sql (#PCDATA | arg)*>
<!ELEMENT condition (sql | (not, sql))>
<!ELEMENT or  EMPTY>
<!ELEMENT and  EMPTY>
<!ELEMENT not  EMPTY>
<!ELEMENT condition_root ( condition | (condition , ((and, condition)*  | (or, condition)*)*))>
\end{verbatim}

\paragraph{Exemple de corps de condition}
\begin{verbatim}
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE condition_root SYSTEM "http://localhost:8095/dtd/condition.dtd">
<condition_root>
<condition>
<sql>select sum>0 from dunning_open_amount where customer_id=<arg>customer_id</arg></sql>
</condition>
<and/>
<condition>
<sql>select category=2 from customer where customer_id=<arg>customer_id</arg></sql>
</condition>
</condition_root>
\end{verbatim}

L'argument des requ\^etes est l'identifiant du client \textsl{customer\_id}. Pour r\'ealiser des op\'erations plus complexes, il est possible d'utiliser des appels \`a des proc\'edures stock\'ees dans les requ\^etes SQL des conditions.
Chacune des 2 requ\^etes pr\'ec\'edentes est \'evalu\'ee avec l'identifiant du client en param\`etre puis le r\'esultat bool\'een est combin\'e avec un \textsl{and}.

\section{Gestion des actions de sortie de recouvrement}
Pour chaque action de recouvrement, il est possible d'associer une action de sortie de recouvrement qui sera r\'ealis\'ee au moment o\`u le client sort du recouvrement (cf. paragraphe ~\ref{sec:sortie_recouvrement}).
Pour associer une action de sortie de recouvrement, aller \`a l'onglet \textsl{Reverse Actions} (cf. figure ~\ref{adama_reverse_actions}).
Cette onglet affiche les actions. Pour associer une ou plusieurs actions de sortie de recouvrement, double-cliquer sur une des actions et la fen\^etre de la figure ~\ref{add_reverse_actions} appara\^it.

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/adama_reverse_actions.eps}
\caption{Onglet des actions de sortie de recouvrement} \label{adama_reverse_actions}
\end{center}
\end{figure}

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/add_reverse_actions.eps}
\caption{Association ou dissociation des actions de sortie de recouvrement} \label{add_reverse_actions}
\end{center}
\end{figure}

Dans la partie gauche \textsl{Rev. Action usable}, la liste des actions de sortie disponibles sont affich\'ees.Pour les associer \`a l'action courante, s\'electionner une des lignes puis appuyer sur la fl\`eche droite: l'action de sorite appra\^it maintenant sur la partie droite \textsl{Rev. Action used}. Pour dissocier l'action de sortie, s\'electionner cette action dans la partie droite puis appuyer sur la fl\`eche gauche. L'action de sortie bascule vers le cadre gauche et est dissoci\'ee de l'action courante.
Les fl\`eches haut et bas d\'eplace l'action s\'electionn\'ee du cadre droit pour indiquer l'ordre de r\'ealisation des actions de sortie de recouvrement: la plus haute est r\'ealis\'ee en $1^\mathrm{er}$.

En appuyant sur le bouton \textsl{Save}, les modifications sont sauvegard\'ees.

\section{Gestion des URL des imports et des flux SOAP}
L'onglet Import (cf figure ~\ref{fig:onglet_import}) affiche:
\begin{itemize}
\item les r\'epertoires des fichiers XML pour les imports d'items (clients, contrats, paiements, factures)
\item les URL pour les flux SOAP d'export
\end{itemize}

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/adama_onglet_import.eps}
\caption{Onglet des URL des imports et des flux SOAP} \label{fig:onglet_import}
\end{center}
\end{figure}

Les r\'epertoires des fichiers XML sont d\'ecrits dans le cadre \textsl{Import Directories}. Ils se caract\'erisent par:
\begin{itemize}
\item Input Directory : le r\'epertoire o\`u se situe le fichier XML.
\item File Prefix : le pr\'efixe du fichier d'import
\item Activate : le statut de l'export ou de l'import. Si le statut est inactif, l'import ou l'export du fichier n'est pas r\'ealis\'e
\item Sequence : le num\'ero de s\'equence du fichier g\'en\'er\'e.
\end{itemize}

Pour r\'esumer, l'import ou l'export a lieu sur les fichiers \textsl{Input Directory}/\textsl{File Prefix}\_\textsl{Seq}\_\textsl{YYYYMMDD}.txt avec \textsl{Seq} un num\'ero de s\'equence sup\'erieur ou \'egal \`a \textsl{Sequence}.

\subsection{Ajout d'un r\'epertoire d'import/export}
Pour ajouter un flux d'import, appuyer sur le bouton \textsl{Add Directory}. La fen\^etre de la figure ~\ref{sec:add_imp_directory} appara\^it.
\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.5\textwidth]{/home/simon/ADAMA/Documentation/image/add_import_directory.eps}
\caption{Ajout d'un r\'epertoire d'import} \label{sec:add_imp_directory}
\end{center}
\end{figure}

\subsection{Suppression d'un r\'epertoire d'import/export}
Pour supprimer un flux d'import, appuyer sur le bouton \textsl{Delete Dir.}. La fen\^etre de la figure ~\ref{sec:del_imp_directory} appara\^it.
\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.5\textwidth]{/home/simon/ADAMA/Documentation/image/del_import_directory.eps}
\caption{Suppression d'un r\'epertoire d'import} \label{sec:del_imp_directory}
\end{center}
\end{figure}

S\'electionner une ligne d'import puis appuyer sur le bouton \textsl{Delete}: le flux d'import est supprim\'e.

\subsection{Ajout d'une URL SOAP}
Pour ajouter une URL SOAP, appuyer sur le bouton \textsl{Add URL}. La fen\^etre de la figure ~\ref{sec:add_soap_url} appara\^it.
\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.5\textwidth]{/home/simon/ADAMA/Documentation/image/add_soap_url.eps}
\caption{Ajout d'une URL SOAP} \label{sec:add_soap_url}
\end{center}
\end{figure}

\subsection{Suppression d'une URL SOAP}
Pour supprimer une URL SOAP, appuyer sur le bouton \textsl{Delete URL}. La fen\^etre de la figure ~\ref{sec:del_soap_url} appara\^it.
\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.5\textwidth]{/home/simon/ADAMA/Documentation/image/del_soap_url.eps}
\caption{Suppression d'une URL SOAP} \label{sec:del_soap_url}
\end{center}
\end{figure}

S\'electionner une URL puis appuyer sur le bouton \textsl{Delete}: l'URL est supprim\'ee.

\subsection{Lancement d'un import}
Pour d\'emarrer l'import des fichiers XML, il est n\'ecessaire que le process \textsl{adamad} soit actif (cf. paragraphe ~\ref{sec:lancement_adamad}). En appuyant sur le bouton \textsl{Start Import}, le module d'import est lanc\'e (cf. paragraphe ~\ref{sec:module_import}). Le bouton \textsl{Stop Import} n'a pas d'action r\'eelle pour la version actuelle d'ADAMA.

%%\section{Description des r\^oles du module d'administration}
%%\label{sec:par6}Le fichier \$ADAMA\_HOME/conf/password.lst contient le nom des utilisateurs, leur mot de passe et la liste des modules qu'ils ont le droit d'utiliser. Les mots de passe sont crypt\'es.

%%\section{Actions applicables aux items de recouvrement}
%%\label{sec:paractions}Deux types d'actions sont applicables:
%%\begin{itemize}
%%\item les actions r\'eseaux:
%%	\begin{itemize}
%%	\item suspension d'une ressource
%%	\item activation ou r\'eactivation d'une ressource
%%	\item d\'esactivation d'une ressource
%%	\item suspension du contrat
%%	\item activation ou r\'eactivation du contrat
%%	\item d\'esactivation du contrat
%%	\item suspension du client qui entra\^ine la suspension de l'ensemble des contrats du client
%%	\item r\'eactivation du client qui entra\^ine la r\'eactivation de l'ensemble des contrats du client
%%	\end{itemize}
%%
%%	Les actions r\'eseaux appliqu\'ees aux items de recouvrement ne sont pas r\'epercut\'es sur les syst\`emes dialoguant avec ADAMA. Pour cela, ces actions sont notifi\'ees par l'interm\'ediaire de fichiers XML g\'en\'er\'es par ADAMA et transf\'er\'es vers les syst\`emes impact\'es (module d'export ) ou des flux SOAP d\'efinis par l'administrateur (cf.~\ref{section:moduleexport}).\\
%%	Chacune des actions r\'eseaux est impl\'ement\'ee par une proc\'edure stock\'ee en base:
%%	\begin{itemize}
%%	\item modify\_resource\_status(i\_contract\_id \textsl{int}, v\_status \textsl{character varying}) o\`u v\_status a les valeurs suivantes: a, s
%%	\item modify\_contract\_status(i\_contract\_id \textsl{int}, v\_status \textsl{character varying}) o\`u v\_status a les valeurs suivantes: a, s ou d
%%	\item modify\_customer\_status(i\_customer\_id \textsl{int}, v\_status \textsl{character varying}) o\`u v\_status a les valeurs suivantes: a, s ou d
%%	\end{itemize}
%%
%%\item les actions non r\'eseaux:
%%	\begin{itemize}
%%	\item envoi de SMS au client
%%	\item envoi de courrier
%%	\item g\'en\'eration de frais de dossier, de frais caus\'es par les actions r\'eseaux
%%	\item envoi de notes aux CDC pour actions ou notification
%%	\end{itemize}
%%
%%	Les actions non r\'eseaux appliqu\'ees aux items de recouvrement ne sont pas r\'epercut\'es sur les syst\`emes dialoguant avec ADAMA. Pour cela, ces actions sont notifi\'ees par l'interm\'ediaire de fichiers XML g\'en\'er\'es par ADAMA et transf\'er\'es vers les syst\`emes impact\'es (module d'export ) ou des flux SOAP d\'efinis par l'administrateur (cf.~\ref{section:moduleexport}).\\
%%\end{itemize}

\section{Contr\^ole du serveur ADAMA et des traitements}
L'onglet \textsl{Engine} a 2 fonctionnalit\'es:
\begin{itemize}
\item d\'emarrer le serveur \textsl{adamad}
\item d\'emarrer le moteur de traitement des clients
\end{itemize}

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/adama_engine.eps}
\caption{Onglet de contr\^ole des traitements} \label{sec:onglet_engine}
\end{center}
\end{figure}

\subsection{Lancement du serveur \textsl{adamad}}
Pour lancer le serveur \textsl{adamad}, appuyer sur le bouton \textsl{Start Daemon}. Si le serveur se lance sans erreur, le feu passe au vert. Sinon, il passe \`a l'orange.
Pour arr\^eter le serveur, appuyer sur le bouton \textsl{Stop Daemon}.
Le champ \textsl{Config. File} indique le fichier de param\'etrage du serveur. Ce fichier contient:
\begin{itemize}
\item le nom de la base de donn\'ees \`a laquelle se connecte le serveur
\item l'utilisateur
\item le mot de passe associ\'e
\item le nombre de connexions vers la base disponibles pour l'interface d'administration
\end{itemize}

\paragraph{Remarque} En cas d'erreur de d\'emarrage du serveur \textsl{adamad}, les logs d'ADAMA sont consultables. Le plus souvent, l'erreur est provoqu\'e par l'existence du fichier /tmp/adama\_socket qui ne doit pas exister au d\'emarrage mais doit \^etre cr\'e\'e par \textsl{adamad}, ou par l'existence du fichier \$ADAMA\_HOME/work/adama.pid qui fonctionne de la m\^eme mani\`ere que /tmp/adama\_socket.

\subsection{Lancement du moteur de traitement des clients}
Avant de lancer le moteur de traitement des clients, il est n\'ecessaire que le serveur \textsl{adamad} soit actif. La rubrique \textsl{Thread Number} indique le nombre de process lanc\'es en parall\`eles par le moteur de traitement des clients. Le moteur de traitement d\'ecoupe l'ensemble des clients en autant de paquets que de threads.
Une fois le nombre de threads fix\'e, le moteur est lanc\'e en appuyant sur le bouton \textsl{Start Engine}. La liste \textsl{Engine Thread Status} indique le statut de chaque process lanc\'e.

\section{G\'en\'eration de logs}
ADAMA s'appuie sur le module log4cxx pour g\'en\'erer des logs. Les logs sont param\'etr\'es \`a partir du ficher de configuration \textsl{\$ADAMA\_HOME/log4cxx.properties}.
Les niveaux de logs possibles sont:
\begin{itemize}
\item DEBUG: ce niveau d\'ecrit de mani\`ere tr\`es d\'etaill\'ee les op\'erations r\'ealis\'ees par ADAMA
\item INFO: ce niveau informe l'utilisateur des traitements fonctionnels r\'ealis\'es
\item WARNING: ce niveau informe l'utilisateur des erreurs non bloquantes qui ont lieu pendant le traitement
\item ERROR: ce niveau informe l'utilisateur des erreurs bloquantes qui ont lieu pendant le traitement et qui provoquent l'arr\^et d'ADAMA
\end{itemize}

Chaque niveau inclut le niveau d'erreur sup\'erieur. Ainsi, le niveau d\'ebug inclut tous les autres niveaux.
Les fichiers de logs sont cr\'ees de mani\`ere quotidienne. Il n'existe qu'un fichier de log par module et par jour de traitement. Ceci afin d'\'eviter de g\'erer un trop grand nombre de fichiers.

Voici un exemple de fichier de configuration pour log4cxx.properties:
\begin{verbatim}
inclure log4cxx.properties
\end{verbatim}

\chapter{Le module des Charg\'es de Client\`ele}

Le module des Charg\'es de Client\`ele permet au CDC de:
	\begin{itemize}
	\item consulter les informations li\'ees au client (nom, pr\'enom, civilit\'e, \ldots)
	\item consulter les contrats du client
	\item consulter les factures du client
	\item consulter les paiements effectu\'es par le client
	\item consulter l'historique des actions de recouvrement appliqu\'ees au client
	\item consulter les p\'enalit\'es
	\item consulter l'historique des \'etapes de recouvrement du client
	\item situer le client dans un cycle de recouvrement
	\item consulter les ticklers destin\'es au CDC
	\end{itemize}

\section{Lancement du module des Charg\'es de Client\`ele}
Se d\'eplacer dans le r\'epertoire: \$ADAMA\_HOME/bin.

Pour lancer le module, cliquer sur le fichier de commandes:
\begin{verbatim}
adama_cdc
\end{verbatim}

Le login, le mot de passe et la base de donn\'ees sont demand\'es et l'utilisateur acc\`ede au module des CDC. Afin d'\'eviter une saisie r\'ep\'etitive du nom de la base de donn\'ees, il peut \^etre param\'etr\'e dans le fichier \$HOME/ADAMA/cdc.ini dans la variable DBLISTS.\\

\section{Description du mode graphique du module de CDC}
\label{sec:par21} La barre principale contient les onglets suivants:
	\begin{itemize}
	\item File
	\item Find
	\end{itemize}

Le menu Find contient le sous-menu Customer pour chercher un client en base. Un client est recherch\'e \`a partir (cf. figure ~\ref{sec:find_customer}):
	\begin{itemize}
	\item de la r\'ef\'erence client
	\item de l'identifiant interne ADAMA (customer\_id)
	\item de la r\'ef\'erence de l'un de ses contrats
	\item de la r\'ef\'erence de l'une de ses factures
	\item du num\'ero de une de ses ressources
	\end{itemize}

\begin{figure}[!htp]
\begin{center}
\includegraphics[]{/home/simon/ADAMA/Documentation/image/adama_find_customer.eps}
\caption{Menu \textsl{Find Customer}} \label{sec:find_customer}
\end{center}
\end{figure}

En appuyant sur le bouton OK, le client est charg\'e.

L'onglet \textbf{Infos} permet de visualiser et de modifier sous forme de graphe l'ensemble des caract\'eristiques des clients trait\'es par ADAMA.\\
L'onglet \textbf{Contracts} permet de visualiser et de modifier sous forme de graphe l'ensemble des caract\'eristiques des contrats trait\'es par ADAMA.\\
L'onglet \textbf{Invoices} permet de visualiser et de modifier sous forme de graphe l'ensemble des caract\'eristiques des factures trait\'ees par ADAMA.\\
L'onglet \textbf{Actions} permet de visualiser et de modifier sous forme de graphe les actions appliqu\'ees au client et \`a ses contrats.\\
L'onglet \textbf{Fees} permet de visualiser et de modifier sous forme de graphe l'ensemble des surco\^uts appliqu\'es au client pendant le processus de relance.\\
L'onglet \textbf{Payments} permet de visualiser et de modifier sous forme de graphe l'ensemble des paiements effectu\'es par le client.\\
L'onglet \textbf{History} permet de visualiser sous forme de graphe l'ensemble des \'etapes de relances travers\'ees par le client.\\
L'onglet \textbf{History} permet de visualiser sous forme de graphe l'ensemble des \'etapes de relances travers\'ees par le client.\\
L'onglet \textbf{Ticklers} contient les ticklers destin\'ees au CDC.\\

\subsection{Description de l'onglet \textbf{Infos}}
\label{subsec:att_client} L'interface graphique activ\'ee par l'onglet Infos (cf.figure ~\ref{sec:onglet_infos}) indique \`a l'utilisateur:
	\begin{itemize}
	\item dans la rubrique \textsl{Customer Reference}
		\begin{itemize}
		\item la r\'ef\'erence du client
		\item le statut du client. Les clients non actifs n'avancent pas dans les cycles de recouvrement
		\end{itemize}
	\item dans la rubrique \textsl{Balances}
		\begin{itemize}
		\item le solde du client: somme des factures - somme des paiements cr\'editeurs + somme des paiements d\'ebiteurs
		\item le solde des factures en relance
		\item le solde des factures litigieuses en relance
		\end{itemize}
	\item dans la rubrique \textsl{Identity}
		\begin{itemize}
		\item la civilit\'e du client. Le choix des civilit\'es est param\'etr\'e dans la table CIVILITY
		\item le nom du client
		\item le pr\'enom du client
		\item les pr\'enoms du client autres que celui mentionn\'e pr\'ec\'edemment
		\end{itemize}
	\item dans la rubrique \textsl{Address}
		\begin{itemize}
		\item le num\'ero de rue et l'extension
		\item le nom de la rue
		\item le code ZIP et la ville
		\item l'\'etat ou le d\'epartement
		\item le pays
		\end{itemize}
	\item dans la rubrique \textsl{Responsible}
		\begin{itemize}
		\item l'identifiant du CDC responsable du suivi de ce client
		\item l'utilisateur ayant effectu\'e la derni\`ere modification sur ce client. A la version actuelle d'ADAMA, ce champ n'est pas renseign\'e.
		\end{itemize}
	\end{itemize}

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/cdc_onglet_infos.eps}
\caption{Onglet Infos} \label{sec:onglet_infos}
\end{center}
\end{figure}

Si un des champs de l'interface est modifi\'e ou rempli, le bouton \textsl{Save} s'active et il est possible de sauvegarder les modifications.

\paragraph{Remarque} La sauvegarde des informations modifi\'ees est r\'ealis\'ee par un flux SOAP au format XML. Le format XML de mise \`a jour des informations client est dans le fichier \$ADAMA\_HOME/work/xsd/customer\_update.xsd.

\subsection{Description de l'onglet \textbf{Actions}}
\label{subsec:att_cactions} L'onglet Actions (cf. figure ~\ref{sec:onglet_actions}) indique \`a l'utilisateur:
	\begin{itemize}
	\item dans la rubrique \textsl{Current Step}
		\begin{itemize}
		\item l'\'etape courante du client (descripteur court et long)
		\end{itemize}
	\item dans la rubrique \textsl{Next Step}
		\begin{itemize}
		\item l'\'etape suivante du client
		\end{itemize}
	\item dans la rubrique \textsl{Action List}, la liste des actions appliqu\'ees au client avec:
		\begin{itemize}
		\item la description
		\item sa p\'eriodicit\'e
		\item si l'action a \'et\'e r\'ealis\'ee
		\item si elle est obligatoire
		\item la date de d\'ebut de l'action
		\end{itemize}
	%\item la dur\'ee de l'\'etape en jours
	%\item la date d'entr\'ee dans l'\'etape
	%\item les actions de relance appliqu\'ees au client
	\end{itemize}

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/cdc_onglet_actions.eps}
\caption{Onglet des Actions} \label{sec:onglet_actions}
\end{center}
\end{figure}

\subsection{Description de l'onglet \textbf{Invoices}}
\label{subsec:att_facture} L'onglet Invoices indique \`a l'utilisateur les factures du client (cf. figure ~\ref{section:cdc_invoices}). Les informations relatives aux factures sont affich\'ees:
\begin{itemize}
\item la r\'ef\'erence
\item la date d'\'ech\'eance
\item la date de cr\'eation dans ADAMA
\item le montant initial (en euros)
\item le montant ouvert (en euros)
\item flag de litige. Si une facture est litigieuse, la case est coch\'ee
\item type de la facture
	\begin{itemize}
	\item IN: le client a une dette envers l'entreprise
	\item CN: l'entreprise a une dette envers le client
	\end{itemize}
\end{itemize}

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/cdc_onglet_invoices.eps}
\caption{Onglet Invoices} \label{section:cdc_invoices}
\end{center}
\end{figure}

En double-cliquant sur la ligne contenant la facture, le flag de litige est d\'esactiv\'e si il est actif, actif s'il est d\'esactiv\'e.
%En double-cliquant sur la ligne contenant la facture, une fen\^etre \textbf{Ech\'eanciers} appara{\^\i}t. Cette fen\^etre donne acc\'es aux \'ech\'eanciers de la facture. Il permet \'egalement de cr\'eer de nouveaux \'ech\'eanciers.
%L'\'ech\'eancier est d\'efini par:
%	\begin{itemize}
%	\item un montant
%	\item la date de paiement de l'\'ech\'eance
%	\item l'\'etat de l'\'ech\'eance (pay\'ee ou impay\'ee)
%	\end{itemize}
%Par d\'efaut, lorsqu'une \'ech\'eance est cr\'e\'ee, elle est impay\'ee.

\subsection{Description de l'onglet \textbf{Payments}}
\label{subsec:att_paiement} En cliquant sur l'onglet Payments (cf. figure ~\ref{section:cdc_payments}), l'utilisateur obtient les renseignements concernant les paiements effectu\'es par le client:
	\begin{itemize}
	\item la r\'ef\'erence du paiement
	\item le montant initial du paiement (en euros)
	\item la date d'enregistrement
	\item le type du paiement (D: paiement entrant, C: paiement rejet\'e)
	\item le montant ouvert du paiement
	\end{itemize}

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/cdc_onglet_payments.eps}
\caption{Onglet Payments} \label{section:cdc_payments}
\end{center}
\end{figure}

\subsection{Description de l'onglet \textbf{Contracts}}
\label{subsec:att_contrat} L'interface graphique activ\'ee par l'onglet Contracts (cf. figure ~\ref{sec:cdc_contracts}) indique \`a l'utilisateur:
	\begin{itemize}
	\item la r\'ef\'erence du contrat
	\item l'\'etat du contrat: activ\'e, d\'esactiv\'e
	\item la date de derni\`ere modification du statut du contrat
	\item la ressource associ\'ee au contrat
	\item l'\'etat de la ressource. Il arrive qu'un contrat soit actif mais que la ressource associ\'ee soit inactive. Typiquement, en cas de changement de num\'ero de t\'el\'ephone d'une ligne, l'ancien num\'ero est inactif.
	\end{itemize}

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/cdc_contracts.eps}
\caption{Onglet des contrats} \label{sec:cdc_contracts}
\end{center}
\end{figure}

\paragraph{Remarque} Il n'est pas possible d'ajouter un contrat au client par l'interface graphique. L'utilisateur doit utiliser le flux SOAP d'import ou le module d'import (cf. paragraphe ~\ref{sec:module_import}).

\subsubsection{Modification du contrat d'un client}
Pour modifier le contrat d'un client, double-cliquer sur la ligne du contrat. La fen\^etre de la figure ~\ref{sec:cdc_modif_contracts} appara\^it. Le bouton \textsl{Save} sauvegarde les \'eventuelles modifications effectu\'ees.

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/cdc_modif_contracts.eps}
\caption{Modification d'un contrat} \label{sec:cdc_modif_contracts}
\end{center}
\end{figure}

\subsection{Description de l'onglet \textbf{Fees}}
\label{subsec:att_fees} En cliquant sur l'onglet Fees (cf. figure ~\ref{section:cdc_fees}), l'utilisateur obtient la liste des p\'enalit\'es ou gestes commerciaux affect\'es au client. Les fees ont les caract\'eristiques suivantes :
	\begin{itemize}
	\item la description de la p\'enalit\'e ou geste commercial
	\item le montant initial (en euros)
	\item le montant ouvert
	\item la date de modification
	\end{itemize}

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/cdc_onglet_fees.eps}
\caption{Onglet Fees} \label{section:cdc_fees}
\end{center}
\end{figure}

\subsection{Description de l'onglet \textbf{History}}
\label{subsec:att_history} En cliquant sur l'onglet History (cf. figure ~\ref{section:cdc_history}), l'utilisateur obtient l'historique des \'etapes travers\'ees par le client par ordre d\'ecroissant. Les \'etapes ont les caract\'eristiques suivantes :
	\begin{itemize}
	\item la description de l'\'etape
	\item la ou les actions associ\'ees
	\item l'ordre de l'\'etape
	\item la date d'entr\'ee en \'etape
	\item flag de r\'ealisation des actions associ\'ees
	\end{itemize}

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/cdc_onglet_history.eps}
\caption{Onglet History} \label{section:cdc_history}
\end{center}
\end{figure}

\subsection{Description de l'onglet \textbf{Snapshot}}
\label{subsec:att_snapshot} L'onglet Snapshot (cf. figure ~\ref{section:cdc_snapshot}) indique l'\'etape courante du client dans le cycle de relance sous forme graphique. Cette \'etape est color\'ee en vert. Pour obtenir la description d'une \'etape, cliquer sur l'\'etape avec le bouton gauche: le nom de l'\'etape appara\^it en gris\'e.

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/cdc_onglet_snapshot.eps}
\caption{Onglet Snapshot} \label{section:cdc_snapshot}
\end{center}
\end{figure}

\subsection{Description de l'onglet \textbf{Ticklers}}
\label{subsec:att_ticklers} L'onglet Ticklers (cf. figure ~\ref{section:cdc_ticklers}) liste les ticklers destin\'es aux charg\'es de client\`ele (TICKLER\_RECORDS.responsible = utilisateur de connexion ou vide). 
Pour chaque tickler, les informations suivantes sont affich\'ees:
\begin{itemize}
	\item la description du tickler
	\item le statut du tickler. Les statuts possibles sont:
	\begin{itemize}
		\item NEW : \'etat initial du tickler \`a l'insertion dans la table TICKLER\_RECORDS
		\item OPEN : \'etat du tickler lorsqu'il est pris en charge par un CDC
		\item CLOSED : \'etat du tickler lorsque le CDC l'a trait\'e
	\end{itemize}
	\item la date d'insertion de l'enregistrement dans TICKLER\_RECORDS
	\item la date de modification de l'enregistrement dans TICKLER\_RECORDS
	\item le contenu du tickler
	\item le CDC responsable du tickler
	\item le type du tickler. Les diff\'erents types de tickler sont:
	\begin{itemize}
		\item INFO : le tickler remonte une information au CDC
		\item ACTION : le CDC est sens\'e r\'ealis\'e une action pour traiter le tickler
	\end{itemize}
\end{itemize}

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/cdc_onglet_ticklers.eps}
\caption{Onglet Ticklers} \label{section:cdc_ticklers}
\end{center}
\end{figure}

\subsubsection{Modification d'un tickler}
Pour modifier un tickler, double-cliquer sur l'enregistrement dans l'onglet Ticklers. La fen\^etre de la figure ~\ref{section:cdc_modif_ticklers} appara\^it.

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.99\textwidth]{/home/simon/ADAMA/Documentation/image/cdc_modif_ticklers.eps}
\caption{Modification d'un tickler} \label{section:cdc_modif_ticklers}
\end{center}
\end{figure}

Modifier les informations souhait\'ees puis appuyer sur le bouton \textsl{OK}. La rubrique Notes contient les notes que souhaite rajouter le CDC.

\chapter{Communication avec les interfaces d'ADAMA}

\section{Introduction}
ADAMA accepte en entr\'ee un ensemble d'items. De m\^eme, en sortie, ADAMA g\'en\'ere des ensembles d'items. Chaque item est compos\'e d'un ensemble d'attributs.

Le module d'import d'ADAMA importe dans le syst\`eme des items sous forme :
\begin{itemize}
\item de fichiers XML d\'epos\'es sur le serveur qui abrite ADAMA
\item de flux SOAP
\end{itemize}

Le module d'export d'ADAMA exporte du syst\`eme des items sous forme :
\begin{itemize}
\item de fichiers XML d\'epos\'es sur le serveur qui abrite ADAMA
\item de flux SOAP
\item de tickler stock\'e en base de donn\'ees
\end{itemize}

%\paragraph{Fichiers de variables XML globales} Il est possible de d\'efinir des variables globales dans ADAMA. Le fichier contenant ces variables est \$ADAMA\_HOME/data/global\_variables.conf. Pour utiliser ces variables, il suffit de les pr\'efixer par la caract\`ere \$ \`a la mani\`ere des variable SHELL. La caract\`ere d'\'echappe est $\backslash$. Un exemple de fichier standard est fourni en annexe (cf.~\ref{paragraph:globalvariables}).

\section{Le module d'import d'ADAMA}
\label{sec:module_import}
L'ensemble minimal des items n\'ecessaires au fonctionnement d'ADAMA sont:
\begin{itemize}
	\item l'item client: les attributs sont d\'efinis au paragraphe~\ref{subsec:att_client}
	\item l'item contrat: les attributs sont d\'efinis au paragraphe~\ref{subsec:att_contrat}
	\item l'item facture: les attributs sont d\'efinis au paragraphe~\ref{subsec:att_facture}
	\item l'item paiement: les attributs sont d\'efinis au paragraphe~\ref{subsec:att_paiement}
\end{itemize}
L'ensemble des items d'import sont d\'ecrits dans des fichiers au moyen de sch\'emas XML. Ces fichiers sont situ\'es dans le r\'epertoire \$ADAMA\_HOME/work/xsd/. Ils permettent un contr\^ole du typage et de la valeur de chaque attribut.
La liste des sch\'emas XML est la suivante:
\begin{itemize}
	\item customer\_import.xsd
	\item customer\_update.xsd
	\item contract\_import.xsd
	\item contract\_update.xsd
	\item invoice\_import.xsd
	\item invoice\_update.xsd
	\item payment\_import.xsd
	\item customer\_commit.xsd
\end{itemize}

Les pr\'efixes de fichiers accept\'es par ADAMA sont:
\begin{itemize}
\item CONTRACT
\item INVOICE
\item CUSTOMER
\item PAYMENT
\end{itemize}

%L'URL d'entr\'ee correspond \`a la localisation du fichier de donn\'ees des clients en entr\'ee d'ADAMA.
%\label{fichier_types_xml} Pour chaque item d'entr\'ee, une table existe en base de donn\'ees. Si elle n'existe pas, elle est cr\'e\'ee.

% rajouter les types en tant qu'attribut des variables d\'efinies + haut

%Voici un exemple de la DTD de l'item Contrat \textsl{contract.dtd}:
% Se referer a la table CONTRAT et CONTRACT\_HISTORY
%\begin{verbatim}
%<!ELEMENT url_entree contrat (ref_contract, customer_ref, status, status_modification_date)>
%<!ELEMENT url_entree (#PCDATA) #REQUIRED>
%<!ELEMENT ref_contract (#PCDATA) #REQUIRED>
%<!ELEMENT customer_ref (#PCDATA) #REQUIRED>
%<!ELEMENT status (#PCDATA) #REQUIRED>
%<!ELEMENT status_modification_date (#PCDATA)>
%\end{verbatim}
%
%Voici un exemple de la DTD de l'item Facture \textsl{invoice.dtd}:
%\begin{verbatim}
%<!ELEMENT url_entree (#PCDATA) >
%<!ELEMENT invoice_ref (#PCDATA) >
%<!ELEMENT customer_ref (#PCDATA) >
%<!ELEMENT due_date (#PCDATA) >
%<!ELEMENT dunning_entry_date (#PCDATA) >
%<!ELEMENT initial_open_amount (#PCDATA) >
%<!ELEMENT open_amount (#PCDATA)>
%<!ELEMENT litigious_invoice (#PCDATA)>
%<!ELEMENT invoice (invoice_ref, customer_ref, due_date, dunning_entry_date, initial_open_amount, open_amount, litigious_invoice )>
%<!ELEMENT invoice_import (url_entree, invoice*)>
%\end{verbatim}
%Le format des dates due\_date et dunning\_entry\_date est DD/MM/YYYY.

\subsection{Sch\'ema XML d\'ecrivant le client: customer\_import.xsd}
Ci-dessous un tableau contenant les \'el\'ements du fichier XML pour l'import du client.
Il se compose globalement de 2 parties:
\begin{itemize}
\item les d\'etails du client
\item les informations de relance relatives au client
\end{itemize}

\begin{tabular}{|p{0.25\textwidth}|p{0.25\textwidth}|p{0.25\textwidth}|p{0.25\textwidth}|}
\hline
Nom \'el\'ement & Type & Modifiable & Commentaires \\
\hline
\hline
import\_customer\_optest & & N & El\'ement XML \\
\hline
source\_id & varchar[30] & N & Syst\`eme source du message XML \\
\hline
url\_entree & varchar[50] & N & URL d'origine \\
\hline
customer\_detail & & N & El\'em\'ent XML \\
\hline
code\_operation & integer & N & Chrono du message XML, g\'er\'e par l'\'emetteur \\
\hline
reference & varchar[100] & N & R\'ef\'erence du client \\
\hline
name & varchar[250] & O & Nom du client \\
\hline
surname & varchar[250] & O & Pr\'enom du client \\
\hline
other\_surname & varchar[250] & O & Autre pr\'enom du client \\
\hline
civility & varchar & O & Valeurs possibles: "M.", "Mlle", "STE", "Mme" \\
\hline
phone1 & varchar[50] & O & T\'el\'ephone de contact \\
\hline
phone2 & varchar[50] & O & T\'el\'ephone de contact \\
\hline
fax & varchar[50] & O & Fax de contact \\
\hline
e\_mail & varchar[150] & O & Email de contact. Il doit comporter le caract\`ere @ \\
\hline
street\_number & integer & O & Num\'ero de rue \\
\hline
street\_ext & varchar[5] & O & Extension de la rue. Valeurs possibles: BIS, TER \\
\hline
street\_name & varchar[150] & O & Nom de la rue \\
\hline
zip\_code & integer & O & Code ZIP \\
\hline
town & varchar[50] & O & Ville \\
\hline
state & varchar[50] & O & Etat \\
\hline
country & varchar[100] & O & Pays \\
\hline
dunning\_info & & N & El\'ement XML \\
\hline
etat\_client & varchar[1] & O & Etat du client au moment o\`u il est import\'e dans ADAMA. Pour que le client \'evolue dans le cycle de recouvrement, ce champ doit valoir: 'a'. Valeurs possibles: a, s, d \\
\hline
date\_etat & varchar[10] & O & Date de validit\'e de l'\'etat du client. Format: YYYY-MM-DD \\
\hline
categorie & varchar[10] & O & Cat\'egorie du client. Valeurs possibles: RES, PRO, TPE \\
\hline
solde\_courant\_du & float & N & Solde des factures \\
\hline
solde\_du\_recouvrement& float & N & Solde des factures en recouvrement \\
\hline
solde\_du\_recouvrement\_horslitige & float & O & Solde du recouvrement hors factures litigieuses \\
\hline
\end{tabular}
\label{tableau:import_clients}

Pour des informations plus pr\'ecises, se r\'ef\'erer au document customer\_import.xsd.

\subsection{Import des clients}
Chaque client import\'e est ins\'er\'e dans les tables:
\begin{itemize}
\item CUSTOMER
\item CUSTOMER\_DETAIL
\item CUSTOMER\_HISTORY
\end{itemize}

La table CUSTOMER\_DETAIL contient donc l'ensemble des clients g\'er\'es par ADAMA et la table CUSTOMER, les donn\'ees propres \`a la relance des clients. La table CUSTOMER\_HISTORY stocke l'historique des statuts du client. A l'import le client a le statut CUSTOMER\_HISTORY.status = 1 (actif), mod\_date = date\_etat (\'el\'ement XML du fichier CUSTOMER*.XML) puis passe au statut 8, lorsque toutes les informations relatives sont charg\'ees.
Avant d'ins\'erer un client dans CUSTOMER\_DETAIL, le logiciel v\'erifie si la r\'ef\'erence du client existe. Si c'est le cas, une erreur est d\'eclench\'ee.
%Sinon le module d'import met la colonne CUSTOMER.STATUS='a', CURRENT\_STEP=NULL, NEXT\_STEP=NULL et STEP\_ENTRY\_DATE=NULL. De m\^eme, le client est r\'eactiv\'e dans CUSTOMER\_HISTORY. Si le client n'existe pas dans CUSTOMER\_DETAIL, il est ins\'er\'e dans les 2 tables pr\'ec\'edentes.
\paragraph{Remarque} Le champ CUSTOMER.openamount est obsol\`ete. Il est gard\'e pour des raisons de compatibilit\'e.
%s informations du client ins\'er\'ees dans la table CUSTOMER pour le champ OPENAMOUNT ne sont que des donn\'ees indicatives: COMPUT\_MODE='E' et COMPUT\_DATE=NULL. Ces montants sont recalcul\'es \`a partir des montant ouverts des factures import\'ees et des p\'enalit\'es ins\'er\'ees dans la table FEES. Le calcul a lieu au lancement du module de traitement et \`a la fin (cf.~\ref{section:calculmontantouvert}).\\
Le statut du client peut changer de 2 mani\`eres dans ADAMA:
\begin{itemize}
\item par l'interm\'ediaire du module des Charg\'es de Client\`ele. Le CDC peut d\'ecider de suspendre (\'etat s) le client dans son cycle de recouvrement. Dans ce cas, le logiciel ne traitera pas le client durant sa p\'eriode de suspension. A la r\'eactivation du client par le CDC, le logiciel met \`a jour la colonne CUSTOMER\_PATH.REFERENCE\_DATE\_STEP qui indique la date de r\'ef\'erence d'entr\'ee du client dans l'\'etape.
\item lorsque le client est sorti du cycle de recouvrement (\'etat d)
\end{itemize}

\subsection{Sch\'ema XML d\'ecrivant le contrat: contract\_import.xsd}
Ci-dessous un tableau contenant les \'el\'ements du fichier XML pour l'import du contrat.
Il se compose globalement de 2 parties:
\begin{itemize}
\item les informations rattachant le contrat au client
\item la ressource attach\'ee au contrat. Typiquement, le NDI associ\'e au contrat.
\end{itemize}

\begin{tabular}{|p{0.25\textwidth}|p{0.25\textwidth}|p{0.25\textwidth}|p{0.25\textwidth}|}
\hline
\hline
Nom \'el\'ement & Type & Modifiable & Commentaires \\
\hline
\hline
import\_contract\_optest & & N & El\'ement XML \\
\hline
source\_id & varchar[30] & N & Syst\`eme source du message XML \\
\hline
url\_entree & varchar[50] & N & URL d'origine \\
\hline
contract\_detail & & N & El\'em\'ent XML \\
\hline
code\_operation & integer & N & Chrono du message XML, g\'er\'e par l'\'emetteur \\
\hline
contract\_ref & varchar[100] & N & R\'ef\'erence du contrat \\
\hline
customer\_ref & varchar[100] & N & R\'ef\'erence du client \\
\hline
co\_status & varchar[1] & O & Statut du contrat. Valeurs possibles: 'a', 's', 'd' \\
\hline
resource & & N & El\'em\'ent XML \\
\hline
number & varchar[250] & O & Autre pr\'enom du client \\
\hline
res\_status & varchar[1] & O & Statut de la ressource. Valeurs possibles: 'a', 's', 'd' \\
\hline
\end{tabular}
\label{tableau:import_contrats}

Pour des informations plus pr\'ecises, se r\'ef\'erer au document contract\_import.xsd.

\subsection{Import des contrats}
A chaque import des contrats dans ADAMA, le module d'import v\'erifie l'\'etat du contrat.
\begin{itemize}
\item Si le contrat n'existe pas dans la table CONTRACT et que la r\'ef\'erence du client existe dans CUSTOMER\_DETAIL, une ligne est ins\'er\'ee dans la table CONTRACT. De m\^eme, la table CONTRACT\_HISTORY est renseign\'ee. Si la r\'ef\'erence du client n'existe pas dans CUSTOMER\_DETAIL, le module d'import le signale dans le log et continue l'import des autres enregistrements.
\item Si le contrat existe dans la table CONTRACT, avec une r\'ef\'erence client diff\'erente pour le CONTRACT.contract\_seq maximum pour la r\'ef\'erence du contrat, une nouvelle ligne est ins\'er\'ee dans la table CONTRACT en incr\'ementant \textsl{contract\_seq} (cas d'un changement de client propri\'etaire pour un contrat).
\item Si l'\'etat du contrat pr\'esent dans le fichier est diff\'erent de l'\'etat du contrat dans la table CONTRACT\_HISTORY pour le max de contract\_seq pour le contrat donn\'e, une ligne est ins\'er\'ee dans CONTRACT\_HISTORY avec les donn\'ees de l'import.
\item La ressource du contrat et son statut sont mises \`a jour si ils sont diff\'erents des donn\'ees pr\'esents dans l'import en augmentant le num\'ero de s\'equence.
\end{itemize}

\paragraph{Etat des ressources}
\label{paragraph:confirmationbarring}
Chaque ressource pr\'esente dans ADAMA est rattach\'ee \`a un contrat. Le traitement de chaque ressource pr\'esente dans le fichier est r\'ealis\'e de la mani\`ere suivante:
\begin{itemize}
\item si la ressource est pr\'esente dans la table CONTRACT\_RESOURCES, le statut RESOURCE\_STATUS est mis \`a jour ainsi que la date MODIFICATION\_DATE 
\item si la ressource n'est pas pr\'esente dans la table CONTRACT\_RESOURCES, ADAMA v\'erifie que le contrat est pr\'esent dans CONTRACT. Si le contrat est pr\'esent, une ligne est ins\'er\'ee dans CONTRACT\_RESOURCES avec ENTRY\_DATE et MODIFICATION\_DATE \`a la date du jour. Si le contrat n'est pas pr\'esent, la ressource n'est pas enregistr\'ee dans la table CONTRACT\_RESOURCES et l'anomalie est signal\'ee dans les logs.
\end{itemize}

\subsection{Sch\'ema XML d\'ecrivant la facture: invoice\_import.xsd}
Ci-dessous un tableau contenant les \'el\'ements du fichier XML pour l'import de la facture.

\begin{tabular}{|p{0.25\textwidth}|p{0.25\textwidth}|p{0.25\textwidth}|p{0.25\textwidth}|}
\hline
Nom \'el\'ement & Type & Modifiable & Commentaires \\
\hline
\hline
import\_invoice\_optest & & N & El\'ement XML \\
\hline
source\_id & varchar[30] & N & Syst\`eme source du message XML \\
\hline
url\_entree & varchar[50] & N & URL d'origine \\
\hline
invoice & & N & El\'em\'ent XML \\
\hline
code\_operation & integer & N & Chrono du message XML, g\'er\'e par l'\'emetteur \\
\hline
invoice\_ref & varchar[100] & N & R\'ef\'erence du contrat \\
\hline
customer\_ref & varchar[100] & O & R\'ef\'erence du client \\
\hline
due\_date & varchar[10] & N & Date d'\'ech\'eance de la facture. Format: YYYY-MM-DD \\
\hline
dunning\_entry\_date & varchar[10] & N & Date d'entr\'ee en relance de la facture. Format: YYYY-MM-DD \\
\hline
initial\_open\_amount & float & N & Montant initial de la facture en euros \\
\hline
litigious & bool & O & Indique si la facture est litigieuse \\
\hline
type & varchar[2] & N & Type de facture. Valeurs possibles: IN, la facture est positive, CN: avoir \\
\hline
\end{tabular}
\label{tableau:import_factures}

Pour des informations plus pr\'ecises, se r\'ef\'erer au document invoice\_import.xsd.

\subsection{Import des factures}
A chaque import de factures dans ADAMA, le module d'import v\'erifie l'existence du client qui poss\`ede la facture.
\begin{itemize}
\item Si la r\'ef\'erence du client existe dans la table CUSTOMER\_DETAIL, une ligne est ins\'er\'ee dans la table INVOICE. Si la r\'ef\'erence du client n'existe pas dans CUSTOMER\_DETAIL, le module d'import le signale dans le log et continue l'import des autres enregistrements.
\item Si la r\'ef\'erence de la facture existe d\'ej\`a dans la table INVOICE, une erreur est d\'eclench\'ee par la base de donn\'ees car une cl\'e unique est positionn\'ee sur la colonne invoice\_ref.
\end{itemize}

\subsection{Sch\'ema XML d\'ecrivant le paiement: payment\_import.xsd}
Ci-dessous un tableau contenant les \'el\'ements du fichier XML pour l'import du paiement.

\begin{tabular}{|p{0.33\textwidth}|p{0.33\textwidth}|p{0.33\textwidth}|}
\hline
Nom \'el\'ement & Type & Commentaires \\
\hline
\hline
import\_payment\_optest & & El\'ement XML \\
\hline
source\_id & varchar[30] & Syst\`eme source du message XML \\
\hline
url\_entree & varchar[50] &  URL d'origine \\
\hline
payment & & El\'em\'ent XML \\
\hline
code\_operation & integer & Chrono du message XML, g\'er\'e par l'\'emetteur \\
\hline
payment\_ref & varchar[100] & R\'ef\'erence du paiement \\
\hline
customer\_ref & varchar[100] & R\'ef\'erence du client \\
\hline
entry\_date & varchar[10] & Date de cr\'eation du paiement. Format: YYYY-MM-DD \\
\hline
amount & float & Montant du paiement en euros \\
\hline
type & varchar[2] & Type de paiement. Valeurs possibles: 'D' pour paiement, 'C' pour annulation de paiement \\
\hline
payment\_detail & & El\'em\'ent XML \\
\hline
invoice\_ref & varchar[100] & R\'ef\'erence de la facture lettr\'ee par le paiement \\
\hline
distributed\_amount & float & Montant lettr\'e. Ce montant est sup\'erieur ou \'egal \`a 0. C'est le type de paiement qui d\'etermine le signe de la transaction. \\
\hline
\end{tabular}

Pour des informations plus pr\'ecises, se r\'ef\'erer au document payment\_import.xsd.

\subsection{Import des paiements}
L'import des paiements enregistre l'historique des paiements effectu\'es pour une facture \'echue ouverte. Chaque paiement est en partie ou int\'egralement associ\'e \`a une facture. Le montant du paiement - de type 'D' - et la partie affect\'ee au r\'eglement de la facture figurent dans l'item payment\_detail.
%De m\^eme, la date du paiement, le mode de paiement.
Pour chaque montant affect\'e \`a une facture, une ligne est ins\'er\'ee dans la table CASH\_RECEIPT (CASH\_TYPE='C'). L'enregistrement \'etablit un lien entre le paiement et la facture pour le montant sold\'e. Le montant ouvert de la facture est diminu\'e du montant du paiement affect\'e. Si le paiement lettre plusieurs factures \`a la fois, l'import attend en entr\'ee autant d'items que de factures lettr\'ees qui g\'en\'ereront autant d'enregistrements dans la table CASH\_RECEIPT. 
%OBSOLETE
%Dans le cas o\`u le montant du ou des paiements est sup\'erieur au montant ouvert de la facture, un credit note est ins\'er\'e dans la table INVOICE (INVOICE\_REF='CN'+INVOICE\_ID, DUE\_DATE=DUN\_ENTRY\_DATE=SYSDATE, INITIAL\_OPEN\_AMOUNT=OPEN\_AMOUNT=surplus, LITIGIOUS\_INVOICE='Y', TYPE='CN'). La g\'en\'eration des credit notes a lieu \`a la fin de l'import dun fichier de paiements.
Dans le cas d'un rejet de paiement - type 'C' -, le montant ouvert de la facture est incr\'ement\'e du montant du paiement rejet\'e. De m\^eme, un enregistrement est ins\'er\'e dans CASH\_RECEIPT (CASH\_TYPE='D').
Le cas o\`u le montant du paiement est sup\'erieur \`a celui de la facture ne doit pas se produire car l'item payment\_detail indique le montant exact affect\'e \`a la facture. Si le montant du paiement est sup\'erieur, l'import du paiement est rejet\'e. 

\subsection{Sch\'ema XML d\'ecrivant l'op\'eration de commit: customer\_commit.xsd}
Ci-dessous un tableau contenant les \'el\'ements du fichier XML pour le commit du client.

\begin{tabular}{|p{0.33\textwidth}|p{0.33\textwidth}|p{0.33\textwidth}|}
\hline
Nom \'el\'ement & Type & Commentaires \\
\hline
\hline
commit\_customer\_optest & & El\'ement XML \\
\hline
source\_id & varchar[30] & Syst\`eme source du message XML \\
\hline
url\_entree & varchar[50] &  URL d'origine \\
\hline
commit\_detail & & El\'em\'ent XML \\
\hline
code\_operation & integer & Chrono du message XML, g\'er\'e par l'\'emetteur \\
\hline
reference & varchar[100] & R\'ef\'erence du client \\
\hline
activate\_dun & bool & Si activate\_dun = true, CUSTOMER.no\_dunning sera positionn\'e \`a 0, sinon no\_dunning = 1 \\
\hline
\end{tabular}

Pour des informations plus pr\'ecises, se r\'ef\'erer au document customer\_commit.xsd.

\subsection{Commit des clients}
L'op\'eration de commit des clients modifie la colonne CUSTOMER.no\_dunning de mani\`ere \`a activer la relance sur le client. Cette op\'eration est utilis\'ee \`a la fin de l'import du client et de ses items.

\textbf{Pour garantir la coh\'erence des traitements, le client ne sera affect\'e \`a un cycle de recouvrement que lorsque la colonne CUSTOMER.no\_dunning vaut 0. Par d\'efaut cette valeur est positionn\'ee \`a 1 jusqu'\`a ce que le CDC ou le syst\`eme externe positionne la valeur par l'interm\'ediaire du flux SOAP.}\\

\subsection{Modification des clients}
Le tableau ~\ref{tableau:import_clients} contient la colonne \textsl{Modifiable} qui indique si l'attribut de l'objet import\'e est modifiable. Le format du message ou fichier XML pour modifier les clients est d\'ecrit dans le document customer\_update.xsd.
En r\'esum\'e, pour modifier un attribut de client, l'\'el\'ement racine est update\_customer\_optest et chaque \'el\'ement modifi\'e poss\`ede l'attribut: \textsl{modify="1"}.

\paragraph{Exemple de fichier XML de modification de client}
Dans l'exemple qui suit, les 2 pr\'enoms du client sont modifi\'es.

\begin{verbatim}
<adr:update_customer_optest xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://localhost:8095/xsd http://localhost:8095/xsd/customer_update.xsd" xmlns:adr="http://localhost:8095/xsd">
<source_id>TEST_INT</source_id>
<url_entree>/home/ADAMA/work/import/CUSTOMER_1_20070304.txt</url_entree>
        <customer_detail>
                <code_operation>000001</code_operation>
                <reference>REFID775AD41</reference>
                <name modify="1">MIKEL</name>
                <surname modify="1">BRANOT</surname>
                <other_surname modify="0">BRANDT</other_surname>
                <civility modify="0">M.</civility>
                <phone1 modify="0">147390002</phone1>
                <phone2 modify="0"></phone2>
                <fax modify="0">147390003</fax>
                <e_mail modify="0">toto.tata@free.fr</e_mail>
                <street_number modify="0">31</street_number>
                <street_ext modify="0">BIS</street_ext>
                <street_name modify="0">rue Paul-Vaillant Couturier</street_name>
                <zip_code modify="0">92300</zip_code>
                <town modify="0">LEVALLOIS-PERRET</town>
                <state modify="0">IDF</state>
                <country modify="0">France</country>
                <dunning_info>
                        <etat_client modify="0">a</etat_client>
                        <date_etat modify="0">2001-02-03</date_etat>
                        <categorie modify="0">PRO</categorie>
                        <solde_courant_du modify="0">12.3</solde_courant_du>
                        <solde_du_recouvrement modify="0">8</solde_du_recouvrement>
                        <solde_du_recouvrement_horslitige modify="0">6</solde_du_recouvrement_horslitige>
                </dunning_info>
        </customer_detail>
</adr:update_customer_optest>
\end{verbatim}

\subsection{Modification des contrats}
Le tableau ~\ref{tableau:import_contrats} contient la colonne \textsl{Modifiable} qui indique si l'attribut de l'objet import\'e est modifiable. Le format du message ou fichier XML pour modifier les contrats est d\'ecrit dans le document contract\_update.xsd.
En r\'esum\'e, pour modifier un attribut de client, l'\'el\'ement racine est update\_contract\_optest et chaque \'el\'ement modifi\'e poss\`ede l'attribut: \textsl{modify="1"}.

\paragraph{Exemple de fichier XML de modification de contrat}
Dans l'exemple qui suit, le statut du contrat est modifi\'e.

\begin{verbatim}
<adr:update_contract_optest xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://localhost:8095/xsd http://localhost:8095/xsd/contract_update.xsd" xmlns:adr="http://localhost:8095/xsd">
<source_id>TEST_INT</source_id>
<url_entree>/home/ADAMA/work/import/CONTRACT_1_20070304.txt</url_entree>
<contract>
        <contract_detail>
                <code_operation>12351</code_operation>
                <contract_ref>COREFDD775AD46</contract_ref>
                <customer_ref>REFID775AD41</customer_ref>
                <co_status modify="1">s</co_status>
        </contract_detail>
        <resource>
                <number>+33147300001</number>
                <res_status>a</res_status>
        </resource>
</contract>
</adr:update_contract_optest>
\end{verbatim}

\subsection{Modification des factures}
Le tableau ~\ref{tableau:import_factures} contient la colonne \textsl{Modifiable} qui indique si l'attribut de l'objet import\'e est modifiable. Le format du message ou fichier XML pour modifier les factures est d\'ecrit dans le document invoice\_update.xsd.
En r\'esum\'e, pour modifier un attribut de facture, l'\'el\'ement racine est update\_invoice\_optest et chaque \'el\'ement modifi\'e poss\`ede l'attribut: \textsl{modify="1"}.

\paragraph{Exemple de fichier XML de modification de facture}
Dans l'exemple qui suit, la facture de r\'ef\'erence INREFID775AD43 devient litigieuse.

\begin{verbatim}
<adr:update_invoice_optest xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://localhost:8095/xsd http://localhost:8095/xsd/invoice_update.xsd" xmlns:adr="http://localhost:8095/xsd">
<source_id>TEST_INT</source_id>
<url_entree>/home/ADAMA/work/import/CONTRACT_1_20070304.txt</url_entree>
<invoice>
	<code_operation>12350</code_operation>
	<invoice_ref>INREFID775AD43</invoice_ref>
	<customer_ref>REFID775AD41</customer_ref>
	<litigious>true</litigious>
</invoice>
</adr:update_invoice_optest>
\end{verbatim}

\subsection{Lancement de l'import}
Pour lancer le module d'import, aller dans le r\'epertoire \$ADAMA\_HOME/bin, puis taper la commande suivante:
\begin{verbatim}
adama_import &
\end{verbatim}

Le module d'import traitera l'ensemble des fichiers commen{\c c}ant par REF\_SEQ.file, dont le num\'ero de s\'equence vaut REF\_SEQ.seq\_number situ\'es dans le r\'epertoire REF\_SEQ.directory. Il est \'egalement n\'ecessaire que REF\_SEQ.status $<>$ NULL. A la fin du traitement, le dernier num\'ero de s\'equence trait\'e incr\'ement\'e de 1 est enregistr\'e dans REF\_SEQ.seq\_number pour REF\_SEQ.file$=$prefixe.\\
% De m\^eme, les heures de d\'ebut et de fin de traitement sont enregistr\'es dans la colonne START\_IMPORT et END\_IMPORT.\\
Le nom g\'en\'erique d'un fichier de donn\'ees \`a importer est le suivant:\\
directory/$<$prefixe$>$\_$<$numero\_seq$>$\_YYYYMMDDHH24MINSS.xml.
Pour importer un item, d\'eposer les fichiers de donn\'ees XML dans le r\'epertoire d\'efini par la colonne REF\_SEQ.directory pour le pr\'efixe concern\'e.\\

\subsection{Suivi du traitement}
Pendant l'import, la table OPERATION\_STATS enregistre les imports r\'ealis\'es. Chaque \'el\'ement import\'e est caract\'eris\'e par un champ code\_operation qui est enregistr\'e dans la table. Pour conna\^itre le nombre d'\'el\'ements d'un fichier XML import\'e en base (par exemple \textsl{test\_req.xml}), la requ\^ete XML suivante peut \^etre utilis\'ee:
\begin{verbatim}
select count(*) from operation_stats
where operation_url='test_req.xml'
and operation_status=0;
\end{verbatim}

Tant qu'une erreur fatale n'a pas lieu, l'import du fichier a lieu. Si l'import d'un item d\'eclenche une erreur en base de donn\'ees ( client, contrat, \ldots ), l'op\'eration est enregistr\'ee dans OPERATION\_STATS avec un statut=-1. Durant l'import de l'item, le statut vaut 1.

\subsection{Flux SOAP d'import}
Tous les traitements d'import sont disponibles par des flux SOAP. Le message XML trait\'e v\'erifie la m\^eme grammaire XSD que l'import par fichiers XML. Le param\'etrage du flux d'import est r\'ealis\'ee dans le fichier de configuration d'Apache (httpd.conf).
Les requ\^etes \`a destination d'un port TCP \'ecout\'e par Apache et qui contient la cha\^ine \textbf{axis2} est prise en charge par Axis (cf. ~\ref{section:install_apache}).

\subsection{Acquittement d'un flux SOAP}
Pour chaque message SOAP d'import trait\'e, le serveur ADAMA renvoie un message XML d'acquittement. Ce message a la DTD suivante:
\begin{verbatim}
<!ELEMENT source_id (#PCDATA) >
<!ELEMENT op_name (#PCDATA) >
<!ELEMENT op_code (#PCDATA) >
<!ELEMENT op_status (#PCDATA) >
<!ELEMENT op_status_reason (#PCDATA) >
<!ELEMENT ack_report (source_id, op_name, op_code, op_status, op_status_reason )>
<!ELEMENT ack_report_set (ack_report*)>
\end{verbatim}

Les champs source\_id, op\_name et op\_code sont repris du message envoy\'e. op\_status vaut 0 si le traitement du message XML s'est d\'eroul\'e sans erreur et est diff\'erent de 0 sinon.
Dans le cas o\`u op\_status est dif\'erent de 0, le champ op\_status\_reason est renseign\'e par un texte indiquant la raison de l'erreur.

\subsection{Exemple d'acquittement d'un flux SOAP}
\begin{verbatim}
<ack_report_set>
	<ack_report>
		<source_id>TEST_INT</source_id>
		<op_name>commit_customer_optest</op_name>
		<op_code>12355</op_code>
		<op_status>0</op_status>
		<op_status_reason/>
	</ack_report>
</ack_report_set>
\end{verbatim}


\section{Le module d'export d'ADAMA}
\label{section:moduleexport}Les exports sont des flux XML g\'en\'er\'es par ADAMA sous forme de fichiers ou de flux SOAP. Les exports de fichiers sont d\'efinis dans la table EXPORT, les flux SOAP dans la table SOAP\_OUT\_STREAMS.\\
L'export est une fonction associ\'ee \`a une action, elle-m\^eme associ\'ee \`a une \'etape. Ce qui signifie que dans la version actuelle d'ADAMA, l'export est r\'ealis\'e par le moteur de traitement et non manuellement.
Le param\'etrage du r\'epertoire o\`u est g\'en\'er\'e le fichier d'export est dans la table REF\_SEQ. Le lien entre l'export et ce r\'epertoire est dans la table ACTIONS, colonne file\_id ou url\_id pour les flux SOAP.
La colonne ACTIONS.url\_id renvoie vers la table URL\_REF. Cette table contient l'URL vers laquelle le flux SOAP est destin\'e.
L'impl\'ementation des exports est d\'ecrite en d\'etail dans le paragraphe ~\ref{sec:adama_function}.

% Reflechir a l'integrite des exports
% Afin de garantir l'int\'egrit\'e des donn\'ees export\'ees, le module d'export est configurable de mani\`ere \`a emp\^echer tout export durant la p\'eriode de traitement. En dehors de cette contrainte, l'int\'egrit\'e des donn\'ees export\'ees n'est garantie que par les m\'echanismes d'int\'egrit\'e de la base de donn\'ees sous-jacente. Dans la logique ADAMA, un export est une action en soi qui est associ\'ee \`a une \'etape.

% \subsection{Les actions r\'eseaux}
% 
% \subsubsection{Barring entrant ou sortant}
% Pratiquement, le barring se traduit par la restriction des appels entrants ou sortants de la ressource. Tant qu'ADAMA ne re{\c c}oit pas une confirmation de la mise en place du barring, la ressource ne change pas d'\'etat dans CONTRACT\_RESOURCES. La confirmation de la mise en place du barring entrant ou sortant est r\'ealis\'ee par le flux d'import des \'etats des ressources (cf.~\ref{paragraph:confirmationbarring}).
% 
% Le code action associ\'e au barring est: BARRING. Dans le cas o\`u un barring entrant est appliqu\'e au client, le param\`etre de l'action vaut: IN. Si un barring sortant est appliqu\'e au client, le param\`etre vaut: OUT.
% 
% \subsubsection{D\'ebarring entrant ou sortant}
% Le d\'ebarring entrant ou sortant se traduit par la suppression de la restriction des appels entrants ou sortants. Tant qu'ADAMA ne re{\c c}oit pas une confirmation de la mise en place du d\'ebarring, la ressource ne change pas d'\'etat dans CONTRACT\_RESOURCES. La confirmation de la mise en place du d\'ebarring entrant ou sortant est r\'ealis\'ee par le flux d'import des \'etats des ressources (cf.~\ref{paragraph:confirmationbarring}).
% 
% Le code action associ\'e au barring est: DEBARRING. Dans le cas o\`u un d\'ebarring entrant est appliqu\'e au client, le param\`etre de l'action vaut: IN. Si un d\'ebarring sortant est appliqu\'e au client, le param\`etre vaut: OUT.
% 
% \subsubsection{Suspension du contrat}
% La suspension du contrat se traduit par la suspension de l'ensemble des ressources associ\'ees au contrat. Tant qu'ADAMA ne re{\c c}oit pas une confirmation de la suspension du contrat, le contrat ne change pas d'\'etat dans CONTRACT et CONTRACT\_RESOURCES. La confirmation de la suspension du contrat est r\'ealis\'ee par le flux d'import des contrats (cf.~\ref{paragraph:confirmationbarring}).
% 
% Le code action associ\'e \`a la suspension d'un contrat est: SUSPCONT.
% 
% \subsubsection{R\'eactivation du contrat}
% La r\'eactivation du contrat se traduit par la r\'eactivation du contrat et de ses ressources. Tant qu'ADAMA ne re{\c c}oit pas une confirmation de la r\'eactivation du contrat, le contrat ne change pas d'\'etat dans CONTRACT. La confirmation de la r\'eactivation du contrat est r\'ealis\'ee par le flux d'import des contrats (cf.~\ref{paragraph:confirmationbarring}).
% 
% Le code action associ\'e \`a la r\'eactivation du contrat est: REACTCO.
% 
% \subsubsection{Suspension du client}
% La suspension du client se traduit par la suspension du client et de l'ensemble de ses contrats. Tant qu'ADAMA ne re{\c c}oit pas une confirmation de la suspension du client, le client ne change pas d'\'etat dans CUSTOMER. La confirmation de la suspension du client est r\'ealis\'ee par le flux d'import des clients (cf.~\ref{paragraph:confirmationbarring}).
% 
% Le code action associ\'e \`a la suspension d'un client est: SUSPCUST.
% 
% \subsubsection{R\'eactivation du client}
% La r\'eactivation du client se traduit par la r\'eactivation du client. Tant qu'ADAMA ne re{\c c}oit pas une confirmation de la r\'eactivation du client , le client ne change pas d'\'etat dans CUSTOMER. La confirmation de la r\'eactivation du client est r\'ealis\'ee par le flux d'import des clients (cf.~\ref{paragraph:confirmationbarring}).
% 
% Le code action associ\'e \`a la suspension d'un client est: REACCUST.
% 
% \subsection{Les actions non r\'eseaux}
% Le fichier contenant les SMS envoy\'es au client ont le format d\'efini dans la DTD \$ADAMA\_HOME/data/actions\_non\_reseau/envoi\_SMS.dtd (cf.~\ref{paragraph:envoisms}). Le fichier d'export envoi\_SMS.exp en d\'ecoule et est d\'ecrit au chapitre~\ref{chapter:exportimport}.
% L'ensemble des actions r\'eseaux sont trac\'ees dans la table ACTIONS\_NON\_RESEAU.
% 
% \subsubsection{Envoi de SMS au client}
% Les SMS sont param\'etr\'es dans la table SMS (cf.~\ref{paragraph:tablesms}). Le contenu d'un SMS poss\`ede jusqu'\`a 10 valeurs variables. Chaque valeur se pr\'esente sous 2 formes possibles:
% \begin{itemize}
% \item $<$value$>$\textsl{valeur litt\'erale}$<$/value$>$
% \item $<$sql$>$\textsl{requ\^ete SQL renvoyant un unique r\'esultat. Dans le cas o\`u la requ\^ete renvoie plusieurs enregistrements, la valeur du $1^\mathrm{er}$ est prise en compte.}$<$/sql$>$
% \end{itemize}
% 
% Les valeurs sont \'evalu\'ees lors de la construction du message juste avant l'\'ecriture du SMS dans un fichier.
% 
% \subsubsection{Envoi de courrier au client}
% ADAMA d\'efinit plusieurs types de courriers. A chaque type de courrier est associ\'e un fichier de type export qui d\'efinit le mod\`ele du courrier et qui contient les informations qui doivent \^etre envoy\'ees \`a l'imprimeur.
% 
% Le code action associ\'e \`a l'envoi de courrier est: LETTER. Le mod\`ele de courrier est le param\`etre de l'action. Ainsi, chaque type de courrier d\'efinit une action courrier avec un param\`etre diff\'erent.
% Un mod\`ele de courrier est propos\'e dans le fichier \$ADAMA\_HOME/data/items\_export/courrier\_ex1.exp~\ref{paragraph:modelecourrier}. 
% 
% \subsubsection{G\'en\'eration de frais}
% Les montants des frais d\'ependent du type d'action, de la cat\'egorie de client. Ils sont d\'efinis dans la table FEES et g\'en\'er\'es dans le fichier \$ADAMA\_HOME/data/items\_export/fees.exp (cf.~\ref{paragraph:modelefees}). 
% Chaque montant se pr\'esente sous 2 formes possibles:
% \begin{itemize}
% \item $<$value$>$\textsl{valeur litt\'erale}$<$/value$>$
% \item $<$sql$>$\textsl{requ\^ete SQL renvoyant un unique r\'esultat. Dans le cas o\`u la requ\^ete renvoie plusieurs enregistrements, la valeur du $1^\mathrm{er}$ est prise en compte.}$<$/sql$>$
% \end{itemize}
% 
% Le code action associ\'e \`a la g\'en\'eration de frais est: FEES.
% 
% \subsubsection{Envoi de notes aux CDC}
% 2 types de ticklers sont param\'etr\'es en base:
% \begin{itemize}
% \item les ticklers de type INFO. Ils ont une valeur informative pour les CDCs (\'etat des clients, des contrats et des factures).
% \item les ticklers de type ACTION. Ils indiquent aux CDCs une action \`a ex\'ecuter. L'action \`a r\'ealiser est indiqu\'ee dans la colonne ACTION.
% \end{itemize}
% 
% Les ticklers traversent les statuts suivants:
% \begin{itemize}
% \item OPEN : \'etat du tickler \`a l'\'emission
% \item CLOSED : \'etat du tickler lorsqu'il est trait\'e
% \item INPROCESS : \'etat du tickler lorsqu'il est en cours de traitement
% \end{itemize}
% 
% L'envoi de ticklers aux CDC est r\'ealis\'e sous forme:
% \begin{itemize}
% \item d'envoi d'e-mails. La liste des adresses e-mail est param\'etr\'ee dans la colonne TICKLERS.E\_MAIL.
% \item par l'interm\'ediaire de la GUI du module des CDC. Les onglets pour l'affichage des clients, contrats et factures ont un sous-menu Ticklers pour afficher les ticklers concernant ces items de recouvrements.
% \end{itemize}
% Le contenu de chaque tickler se pr\'esente sous 2 formes possibles:
% \begin{itemize}
% \item $<$value$>$\textsl{valeur litt\'erale}$<$/value$>$
% \item $<$sql$>$\textsl{requ\^ete SQL renvoyant un unique r\'esultat. Dans le cas o\`u la requ\^ete renvoie plusieurs enregistrements, la valeur du $1^\mathrm{er}$ est prise en compte.}$<$/sql$>$
% \item $<$sql$>$\textsl{requ\^ete SQL renvoyant un unique r\'esultat. Dans le cas o\`u la requ\^ete renvoie plusieurs enregistrements, chacun de ces enregistrements cr\'ee une lign dans TICKLER\_RECORDS.}$<$/sql$>$
% \end{itemize}
% 
% La table de param\'etrage des ticklers est: TICKLERS. L'ensemble des ticklers \'emis par ADAMA sont stock\'ees dans la table TICKLER\_RECORDS.
% Le code action associ\'e \`a l'envoi d'un tickler est: TICKLER. Le nom du tickler envoy\'e aux CDC est le param\`etre de l'action.
% 
% \subsection{D\'efinition XML des exports}
% L'export est compos\'e:
% \begin{itemize}
% \item d'un param\`etre d\'efini par la colonne EXPORT.parameters
% \item d'un corps d'export d\'efini par la colonne EXPORT.body
% \end{itemize}
% 
% \subsubsection{Param\`etre de l'export}
% Le param\'etre de l'expot est une requte SQL qui comporte un \'el\'ement \textsl{arg} qui va est remplac\'e par l'identifiant du client customer\_id lorsque le param\`etre est \'evalu\'e.
% %\item d'un pattern qui a une valeur unique par param\'etre
% %\item de cl\'es pouvant \^etre r\'ep\'et\'ees de mani\`ere ind\'efinie

\section{Statistiques du module d'export}
Chaque item export\'e est enregistr\'e dans la table SOAP\_OUT\_CUSTOMER. Les informations enregistr\'ees en base sont:
\begin{itemize}
\item l'identifiant du client export\'e
\item l'URL utilis\'ee durant l'export
\item date d'insertion de l'enregistrement
\item identifiant de l'action ayant provoqu\'e l'export
\end{itemize}

% \section{Lancement du module de communication}
% Pour lancer le module de communication, taper la commande:
% \begin{verbatim}
% adama_export [login/mot de passe@environnement de travail] [-gui] &
% \end{verbatim}
% 
% Dans le cas o\`u la cha\^ine de connexion n'est pas pr\'ecis\'ee, le login et le mot de passe seront demand\'es et l'utilisateur passe en mode commande.\\
% Voici les diff\'erentes commandes du mode commande:
% \subparagraph{load items\_import} Cette commande charge l'ensemble des fichiers du r\'epertoire \$ADAMA\_HOME/data/items\_import/ dont le format sera v\'erifi\'e \`a l'aide du fichier DTD associ\'e. Pour chaque item charg\'e, une table est cr\'e\'ee en base de donn\'ees si elle n'existe pas. Les colonnes de la table correspondent aux attributs de l'item. Les diff\'erences de colonnes ou de types de donn\'ees de colonne sont signal\'es dans les logs. Dans le cas o\`u la table associ\'ee est existante, ADAMA v\'erifie la coh\'erence des types de donn\'ees entre le fichier \textsl{types\_items\_entrants.xml} (cf.~\ref{fichier_types_xml}) et le type des colonnes en base de donn\'ees puis passe au traitement de l'item suivant.
% \subparagraph{load items\_export} Cette commande charge l'ensemble des fichiers du r\'epertoire \$ADAMA\_HOME/data/items\_export/ dont le format sera v\'erifi\'e \`a l'aide du fichier DTD associ\'e. La validit\'e des requ\^etes SQL contenues dans les fichiers XML de d\'efinition des exports sont v\'erifi\'ees puis les requ\^etes SQL sont stock\'ees en base sous forme de fonctions invoqu\'ees lorsque la demande d'export aura lieu.
% 
% \section{Purge des tables d'import/export}
% \section{Test d'un export}
% \section{Ajout d'un export dans le s\'equenceur}
% \section{Ajout de l'export dans une API}
% 
% \section{Arborescence d'ADAMA}
% \begin{verbatim}
% $ADAMA_HOME/
% 	bin/
% 	log/
% 	conf/
% 		adamad.conf
% 		password.lst
% 		format_log.[xml|dtd]
% 	data/
% 		actions.[xml|dtd]
% 		compatibilities.[xml|dtd]
% 		compatibilities.[xml|dtd]
% 		customer_types.[xml|dtd]
% 		cycles.[xml|dtd]
% 		etapes.[xml|dtd]
% 		items_import/ 
% 		items_export/ 
% 			actions_reseau.[xml|dtd|exp] 
% 			courrier_ex1.[xml|dtd|exp] 
% 		actions_non_reseau/ 
% 		global_variables.conf
% 		types_items_entrants.[xml|dtd]
% \end{verbatim}

\chapter{Architecture logicielle du module de traitement}

L'ensemble des traitements du logiciel sont ordonnanc\'es par un process serveur en t\^ache de fond \textsl{adamad}. \textsl{adamad} est configurable par l'interm\'ediaire du fichier \$ADAMA\_HOME/conf/adamad.ini. Il est n\'ecessaire de v\'erifier que \textsl{adamad} est lanc\'e avant tout traitement. (cf. chapitre~\ref{chap:this} ).
% Il est possible de configurer ADAMA pour qu'un commit ait lieu en fin de traitement ou non.

\section{Lancement des traitements}
Pour lancer les traitements des clients, aller dans le r\'epertoire \$ADAMA\_HOME/bin, puis taper la commande suivante:
\begin{verbatim}
adama_engine -n 2 &
\end{verbatim}
o\`u -n  indique le nombre de process lanc\'es par l'utilisateur.

% Dans l'exemple ci-dessus, le $1\mathrm{er}$ process traite tous les clients tels que: modulo(customer\_id, 2) $=$ 0. Le second traite tous les clients tels que modulo(customer\_id, 2) $=$ 1. 

\section{S\'equencement des traitements}
\begin{itemize}
\item Au d\'emarrage, adama\_engine scrute la table CUSTOMER\_PATH \`a la recherche de la derni\`ere s\'erie d'actions non r\'ealis\'ees (done = NULL, seq maximum). Ces actions sont ex\'ecut\'ees.
\item adama\_engine scrute la table CUSTOMER\_COMMIT \`a la recherche de clients qui sont sortis de la relance et qui doivent de nouveau \^etre relanc\'es (CUSTOMER\_COMMIT.done $=$ NULL). Pour ces clients, la colonne CUSTOMER.current\_step est mise \`a NULL afin que le client soit affect\'e \`a une \'etape initiale.
\item les clients n'ayant pas d'\'etape initiale (CUSTOMER.current\_step $=$ NULL) sont trait\'es pour qu'une \'etape initiale leur soit affect\'ee (cf. ~\ref{sec:affectation_etape_initiale}).
\item adama\_engine r\'ecup\`ere dans la table CUSTOMER\_PATH:
	\begin{itemize}
	\item les clients qui ont d\'epass\'e la dur\'ee de l'\'etape courante (date courante - reference\_date > dur\'ee de l'\'etape courante )
	\item qui ont toutes leurs actions obligatoires r\'ealis\'ees 
	\item qui ne sont pas dans une \'etape finale
	\item qui sont actifs
	\item qui sont relan{\c c}ables (no\_dunning $=$ 0)
	\end{itemize}
	pour les faire avancer dans le cycle de relance (cf. ~\ref{sec:affectation_etape_suivante})
\end{itemize}

\subsection{Affectation de l'\'etape initiale}
\label{sec:affectation_etape_initiale}
Apr\`es l'import des clients par le module, ces derniers ne sont pas associ\'es \`a une \'etape de recouvrement. Pour d\'eterminer l'\'etape \`a laquelle le client va \^etre affect\'ee, le module de traitement r\'ecup\`ere l'ensemble des \'etapes de la table STEPS dont la colonne PHASE='I' et STATUS='a', les classe en priorit\'e croissante. La 1\`ere \'etape pour laquelle le client remplit les conditions d'entr\'ee est associ\'ee au client.

\subsection{Affectation de l'\'etape suivante}
\label{sec:affectation_etape_suivante}
Pour affecter l'\'etape suivante du cycle de relance d'un client, adama\_engine r\'ecup\`ere l'ensemble des \'etapes suivantes d'une \'etape par ordre de priorit\'e croissante. Pour chaque \'etape de la liste, si celle-ci a une condition d'entr\'ee, elle est \'evalu\'ee avec l'identifiant customer\_id du client. Si la condition est v\'erifi\'ee (c'est-\`a-dire la requ\^ete de la condition renvoie true), l'\'etape est affect\'ee au client. Sinon, l'\'etape prochaine est \'evalu\'ee.
\paragraph{Remarque}
\begin{itemize}
\item Si une \'etape n'a pas de condition d'admission, l'\'evaluation est consid\'er\'ee comme positive.
\item Si aucune \'etape n'est trouv\'ee pour la suite de la relance du client, le module de traitement renvoie une erreur dans la log
\item Le client reste dans l'\'etape actuelle tant que toutes les actions obligatoires de l'\'etape courante n'ont pas \'et\'e r\'ealis\'ees.
\item Il n'existe pas de conditions de sortie d'une \'etape.
\end{itemize}

% \section{Description des traitements}
% \label{sec:description_traitements}
% \label{section:calculmontantouvert} 
%Au lancement des traitements, le module calcule:
%\begin{itemize}
%	\item Le solde courant d\^u: somme des montants ouverts des factures du client + somme des montants ouverts des p\'enalit\'es - somme des paiements 
%	\item Le solde courant d\^u en recouvrement: somme des montants ouverts des factures \'echues du client + somme des montants ouverts des p\'enalit\'es - somme des paiements
%	\item Le solde courant d\^u en recouvrement hors-litige: somme des montants ouverts des factures non litigieuses + somme des montants ouverts des p\'enalit\'es - somme des paiements
%\end{itemize}
% La table CUSTOMER est mise \`a jour avec les donn\'ees calcul\'ees, COMPUT\_MODE='C' et COMPUT\_DATE=SYSDATE.

%A l'entr\'ee d'un cycle de recouvrement, chaque client se voit affect\'e automatiquement une \'etape d\'ependante de ses caract\'eristiques initiales. L'ensemble des traitements suivants est ensuite appliqu\'e au client:
%\begin{itemize}
%	\item Est-ce que les conditions d'admission \`a l'\'etape de sortie de recouvrement sont respect\'ees ?
%	\item Si oui, le client est affect\'e \`a l'\'etape de sortie du recouvrement et les actions associ\'ees \`a la sortie du recouvrement lui sont appliqu\'ees
%	\item Sinon, est-ce que le client est arriv\'e au terme de la dur\'ee de son \'etape?
%	\begin{itemize}
%		\item Si oui, quelles sont les actions de recouvrement obligatoires associ\'ees \`a cette \'etape de recouvrement? Pour chaque action obligatoire non r\'ealis\'ee, r\'ealiser l'action selon sa p\'eriodicit\'e
%		\item Si toutes les actions obligatoires associ\'ees \`a l'\'etape ont \'et\'e r\'ealis\'ees, \'etablir l'\'etape suivante dont les conditions d'admission sont respect\'ees
%		\item Affecter le client \`a l'\'etape trouv\'ee puis appliquer les actions associ\'ees \`a l'\'etape affect\'ee
%		\item Si aucune \'etape suivante ad\'equate n'est trouv\'ee, remonter un log de WARNING et/ou un tickler vers les CDCs.
%		\item Si le client n'est pas arriv\'e au terme de la dur\'ee de son \'etape, appliquer toutes les actions non r\'ealis\'es selon leur p\'eriodicit\'e
%	\end{itemize}
%\end{itemize}

\subsection{Calcul du temps pass\'e dans une \'etape}
La dur\'ee du temps pass\'ee dans une \'etape de recouvrement est calcul\'ee \`a partir de la date CUSTOMER\_PATH.REFERENCE\_DATE. Cette date est mise \`a jour \`a current\_timestamp au moment o\`u l'action associ\'ee \`a l'\'etape est r\'ealis\'ee (DONE='X'). Le temps commence \`a s'\'ecouler lorsqu'au moins une des actions associ\'ees \`a l'\'etape est r\'ealis\'ee. L'action la plus anciennement r\'ealis\'ee dans l'\'etape fixe le d\'ebut de l'\'etape.
Pour chaque action qui doit \^etre r\'ealis\'ee sur un client ou un item de recouvrement, un enregistrement est ins\'er\'e dans la table CUSTOMER\_PATH avec le flag DONE=NULL. Lorsque l'action est r\'ealis\'ee par le module d\'edi\'e, le flag est mis \`a jour \`a X.

% Les clients ayant r\'egl\'e leur facture sont associ\'es \`a une \'etape de sortie. Ils restent \`a l'\'etape de sortie jusqu'\`a confirmation de leur r\'eglement (p\'eriode r\'etention configurable).
% Une fois leur p\'eriode de r\'etention expir\'ee, ces clients sont archiv\'es et purg\'es des tables de traitement.
% PARAGRAPHE OBSOLETE\\
% De m\^eme, les clients arrivant en fin de cycle de recouvrement sont archiv\'es et purg\'es des tables de traitement ainsi que les donn\'ees qui leur sont associ\'ees.\\
% FIN PARAGRAPHE OBSOLETE\\
% ADAMA v\'erifie la coh\'erence des soldes import\'es:
% \begin{itemize}
% \item \`a l'import des clients
% \item \`a l'import des factures.
% \end{itemize}

\section{M\'ecanisme de sortie du recouvrement}
\label{sec:sortie_recouvrement}
Lorsque le client a une balance n\'egative ou nulle, il sort du cycle de recouvrement.

% La vue DUNNING\_OPEN\_AMOUNT\_NO\_CONFLICT calcule en temps r\'e\'el la balance du client. C'est la somme:
\label{paragraph:balance} 
ADAMA surveille la balance du client par l'interm\'ediaire d'un trigger. C'est la somme:
\begin{itemize}
\item des montants ouverts des factures \'echues non litigieuses: INVOICE.open\_amount et INVOICE.litigious\_invoice = false
\item des montants ouverts des p\'enalit\'es: FEES.open\_amount
\item des montants des paiements positifs: PAYMENTS.amount et PAYMENTS.type = 'C'
\item des montants des paiements n\'egatifs: PAYMENTS.amount et PAYMENTS.type = 'D'
\end{itemize}

Lorsque la balance devient n\'egative ou nulle, le client est ins\'er\'e dans la table CUSTOMER\_ROLLBACK. % par l'int\'erm\'ediaire du trigger watch_customer_openamount sur les tables INVOICE, PAYMENTS, FEES.
Le process adama\_rollback scanne la table de mani\`ere p\'eriodique. Les clients ayant un enregistrement tel que DONE=false ont leur cycle de relance arr\^et\'e en les affectant \`a une \'etape de sortie de relance (STEPS.phase = 'P'). ADAMA effectue les actions de relance stock\'ees dans la table REVERSE\_CUSTOMER\_PATH.

\subsection{Lancement du binaire adama\_rollback}
Pour lancer le process de sortie de recouvrement, aller dans le r\'epertoire \$ADAMA\_HOME/bin, puis taper la commande suivante:
\begin{verbatim}
adama_rollback 
\end{verbatim}

\subsection{S\'equence des traitements}
\begin{itemize}
\item Au d\'emarrage, adama\_rollback scrute la table CUSTOMER\_ROLLBACK \`a la recherche des clients en sortie de recouvrement et ayant des actions de sortie de recouvrement non trait\'ees dans REVERSE\_CUSTOMER\_PATH (REVERSE\_CUSTOMER\_PATH.done $=$ NULL, seq maximum, to\_achieve $=$ true et is\_active $=$ true). Ces actions sont r\'ealis\'ees. A l'issue de la r\'ealisations de ces actions, REVERSE\_CUSTOMER\_PATH.done $=$ 'X'.
\item Ensuite, adama\_rollback scrute \`a nouveau la table CUSTOMER\_ROLLBACK \`a la recherche de clients qui ne sont pas en \'etape de parking dans CUSTOMER\_PATH (STEPS.phase $<>$ 'P'). Ces clients sont affect\'es \`a une \'etape de parking.
\item Finalement, la table CUSTOMER\_ROLLBACK est mise \`a jour: done $=$ true \`a condition que toutes les actions obligatoires du client dans REVERSE\_CUSTOMER\_PATH soient r\'ealis\'ees (REVERSE\_CUSTOMER\_PATH.mandatory $=$ 'X', to\_achieve $=$ true, done est null) pour le num\'ero de s\'equence maximum.
\end{itemize}

\subsection{M\'ecanisme de retour en recouvrement}
% La vue DUNNING\_OPEN\_AMOUNT\_NO\_CONFLICT calcule en temps r\'e\'el la balance du client.
Lorsque la balance devient  strictement positive, le client est enregistr\'e dans CUSTOMER\_COMMIT. Au prochain lancement d'adama\_engine, le moteur positionne le client dans la table CUSTOMER sans \'etape: le client est trait\'e comme s'il venait d'\^etre migr\'e. % par l'int\'erm\'ediaire du trigger watch_customer_openamount sur les tables INVOICE, PAYMENTS, FEES

\subsection{Synchronisation entre adama\_engine et adama\_rollback}
Dans le cas o\`u ces 2 process sont lanc\'es simultan\'ement, il se peut qu'il existe un enregistrement dans CUSTOMER\_COMMIT et CUSTOMER\_ROLLBACK pour un m\^eme client. Avant de traiter le client, ils tentent de s'emparer de l'enregistrement du client dans la table CUSTOMER en posant un verrou. Le $1^\mathrm{er}$ qui r\'eussit \`a poser le verrou r\'ealise le traitement.

Avant de poser le verrou, adama\_engine v\'erifie dans la table CUSTOMER\_ROLLBACK s'il n'existe pas d'enregistrement tel que:
\begin{itemize}
\item entry\_date ant\'erieure au timestamp courant
\item done=false
\end{itemize}

Si un enregistrement non trait\'e existe dans CUSTOMER\_ROLLBACK, le client ne rentrera en relance qu'une fois cet enregistrement trait\'e car il n'est pas utile de lui affecter un cycle pour l'en faire sortir au prochain passage d'adama\_rollback.\\
% Le verrou sur la table CUSTOMER est rel\^ach\'e par adama\_engine.\\

De m\^eme adama\_rollback v\'erifie qu'il n'existe pas d'enregistrement non trait\'e dans CUSTOMER\_COMMIT ant\'erieur. S'il existe un enregistrement ant\'erieur, le client n'est pas trait\'e.

% Pour adama\_rollback, \'etant donn\'e que le client sortira de la relance, l'enregistrement est marqu\'e \`a DONE=true dans CUSTOMER\_COMMIT et le client sort de la relance.
% \paragraph{Remarque:} le risque (peu probable) est que si l'\'etape initiale r\'ealise une action type FEES, le client ne se verra pas facturer des frais car il est sorti de la relance.

% \section{Lancement du module de traitement}
% Pour lancer le module de traitement, taper la commande:
% \begin{verbatim}
% adama_process [login/mot de passe@environnement de travail] [-gui] &
% \end{verbatim}
% 
% Dans le cas o\`u la cha\^ine de connexion n'est pas pr\'ecis\'ee, le login et le mot de passe seront demand\'es et l'utilisateur passe en mode commande.\\
% Voici les diff\'erentes commandes du mode commande:
% \subparagraph{process all} Cette commande d\'eclenche le traitement de tous les clients en base d'ADAMA.
% \subparagraph{process cust\_group \textsl{customer\_group\_id}} Cette commande d\'eclenche le traitement de la cat\'egorie  client dont l'identifiant est pass\'e en param\`etre.
% \subparagraph{process customer \textsl{customer\_id}} Cette commande d\'eclenche le traitement du client dont l'identifiant est pass\'e en param\`etre.
% \subparagraph{-gui} Cette option active le mode graphique du module de traitement. Le mode graphique permet de visualiser les caract\'eritiques des clients dans ADAMA. Dans le cas o\`u la cha\^ine de connexion n'est pas pr\'ecis\'ee, une fen\^etre d'authentification appara\^it. Le login de l'utilisateur, le mot de passe et le nom de l'environnement de travail donnent acc\`es au module de traitement.\\
% Le mode graphique est d\'ecrit au paragraphe~\ref{sec:par22}.

\section{Le mode de reprise en cas d'erreur}

% \chapter{Contenu des fichiers de configuration}
% \paragraph{}\$ADAMA\_HOME/data/actions.dtd
% \label{paragraph:actions}
% \begin{verbatim}
% <!ELEMENT actions (action+)>
% <!ELEMENT action (libelle, code, periodicite, type, arguments)>
% <!ELEMENT libelle (#PCDATA)>
% <!ELEMENT code (#PCDATA)>
% <!ELEMENT periodicite (#PCDATA)>
% <!ELEMENT type (#PCDATA)>
% <!ELEMENT arguments (argument+)>
% <!ATTLIST argument type_argument CDATA required>
% \end{verbatim}
% 
% \paragraph{}\$ADAMA\_HOME/data/etapes.dtd
% \label{paragraph:etapes} 
% \begin{verbatim}
% <!ELEMENT etapes (libelle, code, duree_jours, statut, conditions_admission*, actions_associees*, conditions_sortie*, code_etape_suivante*)>
% <!ELEMENT conditions_admission (#PCDATA)>
% <!ELEMENT actions_associees (#PCDATA)>
% <!ELEMENT conditions_sortie (#PCDATA)>
% <!ELEMENT code_etape_suivante (#PCDATA)>
% \end{verbatim}
% 
% \paragraph{}\$ADAMA\_HOME/data/actions\_reseau.dtd
% \label{paragraph:actionsreseau} 
% \begin{verbatim}
% <!ELEMENT actions_reseau (ref_client, ref_contrat, resource, code_action, param_action*)>
% <!ELEMENT ref_client (#PCDATA)>
% <!ELEMENT ref_contrat (#PCDATA)>
% <!ELEMENT resource (#PCDATA)>
% <!ELEMENT code_action (#PCDATA)>
% <!ELEMENT param_action (#PCDATA)>
% \end{verbatim}
% 
% \paragraph{}\$ADAMA\_HOME/data/actions\_non\_reseau/envoi\_SMS.dtd
% \label{paragraph:envoisms} 
% \begin{verbatim}
% <!ELEMENT envoisms (msisdn_appelant, msisdn_appele, message)>
% <!ELEMENT msisdn_appelant (#PCDATA)>
% <!ELEMENT msisdn_appele (#PCDATA)>
% <!ELEMENT message (#PCDATA)>
% \end{verbatim}
% 
% \paragraph{}\$ADAMA\_HOME/data/global\_variables.conf \\
% \label{paragraph:globalvariables} 
% MSISDN\_PLATFORM\_SMS=+33123456789
% 
% \section{Chargement en base de donn\'ees des actions de recouvrement}

% \chapter{Contenu des fichiers d'import et d'export}
% \label{chapter:exportimport} 
% \paragraph{}\$ADAMA\_HOME/data/items\_export/Client\_Traite\_Aujourdhui.exp
% \begin{verbatim}
% <export>
% <url_sortie>url de generation du fichier</url_sortie>
% <sql>
% select <infos_client><id_client>client.id_client</id_client>, <nom>client.nom</nom>, 
% 	<prenom>client.prenom</prenom>,<id_contrat>contrat.id_contrat</id_contrat>, 
% 	<date_traitement>sysdate</date_traitement></infos_client>, <infos_facture><id_facture>facture.id_facture</id_facture></infos_facture>
% 	from client cl, contrat co, facture fa
% 	where date_entree=sysdate and cl.id_client=co.id_client
% 	and fa.id_client=cl.id_client
% </sql>
% </export>
% \end{verbatim}
% 
% \paragraph{}\$ADAMA\_HOME/data/items\_export/envoi\_SMS.exp
% \begin{verbatim}
% <export>
% <url_sortie>url de generation du fichier</url_sortie>
% <sql>
% select <envoisms><msisdn_appelant>contract_resources.resource_number</msisdn_appelant>, <msisdn_appele>""</msisdn_appele>, 
% 	<message>client.prenom</message></envoisms>
% 	from customer cl, contrat co, contract_resources cr
% 	where cl.customer_id=co.customer_id
% 	and customer_id=cl.customer_id
% 	and co.id_contrat=cr.id_contrat
% 	and cr.resource_status='a'
% % Aterminer
% </sql>
% </export>
% \end{verbatim}
% 
% \paragraph{}\$ADAMA\_HOME/data/items\_export/courrier\_ex1.exp
% \label{paragraph:modelecourrier}
% \begin{verbatim}
% <export>
% <url_sortie>url de generation du fichier</url_sortie>
% <sql>
% select <envoicourrier><civility>cd.civility</civility>, <name>cu.name</name>, 
% 	<surname>cu.surname</surname>, <address>cd.address</address>,
% 	<zip_code>cd.zip_code</zip_code>, <town>cd.town</town>,
% 	<country>cd.country</country>, <phone1>cd.phone1</phone1>,
% 	<body>nous vous prion de regler votre facture referencee <ref_facture>in.reference</ref_facture> arrivee a echeance le <bill_date>in.bill_date</bill_date> avant le <payment_date>cde.delay + in.bill_date</payment_date>. Cette facture s'eleve a un montant de <due_amount>in.open_amount</due_amount>.<br/>Je vous prie d'agreer, <civility>cd.civility</civility>, mes sinceres salutation.<signature>John Dunning</signature></body></envoicourrier>
% 	from customer_detail cd, customer cu, invoice in, customer_delay cde
% 	where cd.customer_id=cu.customer_id
% 	and in.customer_id=cu.customer_id
% 	and cde.cust_cat_id=cu.cust_cat_id
% </sql>
% </export>
% \end{verbatim}
% 
% \paragraph{}\$ADAMA\_HOME/data/items\_export/fees.exp
% \label{paragraph:modelefees}
% \begin{verbatim}
% <export>
% <url_sortie>url de generation du fichier</url_sortie>
% <sql>
% select <fees><customer_ref>cu.customer_ref</customer_ref>, <desc>fe.desc</desc>, 
% 	<amount>cu.surname</amount>, <ref_facture>in.reference</ref_facture></fees>
% 	from fees fe, customer cu, customer_history ch
% 	where customer_id=cu.customer_id
% 	and in.customer_id=cu.customer_id
% 	and fe.cust_cat_id=cu.cust_cat_id
% 	and fe.step_id=ch.step_id
% 	and fe.action_id=ch.action_id
% 	and cust_hist_seq = (select max(cust_hist_seq)
% 				from customer_history ch2
% 				where cu.customer_id=ch2.customer_id)
% </sql>
% </export>
% \end{verbatim}
% 
% \section{Liste des types accept\'es}
% \label{subsection:types}Voici la liste des types manipul\'es par ADAMA:
% \begin{itemize}
% 	\item tinyint
% 	\item smallint
% 	\item integer
% 	\item bigint
% 	\item real
% 	\item float
% 	\item double
% 	\item decimal
% 	\item numeric
% 	\item bit
% 	\item char
% 	\item varchar
% 	\item longvarchar
% 	\item binary
% 	\item varbinary
% 	\item longvarbinary
% 	\item date
% 	\item time
% 	\item timestamp
% \end{itemize}
En cas d'erreur technique de type:
\begin{itemize}
\item base de donn\'ees
\item parseur XML
\item \ldots
\end{itemize}
le traitement peut \^etre relanc\'e apr\`es correction de l'origine de l'erreur. L'import d'un item ou la r\'ealisation d'une action est effectu\'ee sous forme de transaction: si il y a une erreur durant cette transaction, il suffit de relancer l'import ou le traitement de l'action.

\chapter{Mod\`ele conceptuel de donn\'ees}

\textbf{Il est imp\'eratif de ne pas modifier l'ordre des colonnes des tables dans le mode de de donn\'ees sous peine de provoquer des erreurs de traitements.}

\section{Description des tables}
\paragraph{ACTIONS\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
ACTION\_ID & Identifiant de l'action & N & integer \\
\hline
DESCRIPTION & Libell\'e de l'action & N & varchar(500) \\
\hline
SHDES & Descripteur court de l'action & N & varchar(10) \\
\hline
PERIOD & P\'eriodicit\'e de l'action. & N & integer \\
\hline
PERIOD\_UNIT & Unit\'e de la p\'eriode. Jour (D), Mois (M), Ann\'ee (Y), 1 fois (O) & N & varchar(5) \\
\hline
FUNCTION\_ID & Identifiant de la proc\'edure stock\'ee associ\'ee & N & integer \\
\hline
PARAM\_ACTION & Liste des param\`etres de l'action. Les param\`etres sont s\'epar\'es les un des autres par le caract\`ere $|$ & N & varchar(100) \\
\hline
MANDATORY & Indique si cette \'etape doit obligatoirement \^etre r\'ealis\'ee avant le passage \`a l'\'etape suivante. Si ce n'est pas le cas, le client restera dans cette \'etape jusqu'\`a ce qu'elle soit r\'ealis\'ee. 'X': obligatoire, vide: sinon & O & varchar(1) \\
\hline
ACTION\_TYPE & Dans le cas d'une action de sortie de recouvrement, indique si cette action s'accumule aux autres actions d\'ej\`a pr\'esentes en table ou bien est exclusive avec les autres actions du client. Valeurs possibles: 'A' ou 'E' & N & varchar(1) \\
\hline
IS\_REVERSE\_ACTION & Est-ce que cette action est une action de sortie de recouvrement ? & N & boolean \\
\hline
URL\_ID & URL du flux SOAP associ\'e \`a l'action. FK vers URL\_REF.url\_id & N & integer \\
\hline
FILE\_ID & URL du fichier g\'en\'er\'e. FK vers REF\_SEQ.file\_id & N & integer \\
\hline
\end{tabular}

\paragraph{ACTIONS\_FUNCTIONS\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
FUNCTION\_ID & Identifiant de la fonction & N & integer \\
\hline
TYPE\_PROC\_ID & Identifiant de la proc\'edure stock\'ee (PS) ou de la fonction du code (F) ou de l'export (EXP) ou du tickler (TI) & N & integer \\
\hline
TYPE\_PROC & Proc\'edure stock\'ee (PS), Fonction du code (F), Export (EXP), Tickler (TI) & N & varchar(10) \\
\hline
\end{tabular}

\paragraph{ACTIONS\_STEPS\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
STEP\_ID & Identifiant de l'\'etape & N & integer \\
\hline
ACTION\_ID & Identifiant de l'action & N & integer \\
\hline
ACTION\_SEQ & Ordre d'ex\'ecution de l'action \`a l'int\'erieur d'une \'etape & N & integer \\
\hline
\end{tabular}

\paragraph{ADAMA\_CONFIG\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
PARAMETER & Parameter name & N & varchar(250) \\
\hline
VALUE & Parameter value & N & varchar(500) \\
\hline
DESCRIPTION & Parameter description & N & varchar(500) \\
\hline
\end{tabular}

\paragraph{CASH\_RECEIPT\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
TRANSACTION\_ID & Identifiant de la transaction & N & integer \\
\hline
CASH\_TYPE & D\'ebit (D), Cr\'edit (C) & N & varchar(10) \\
\hline
INVOICE\_ID & Identifiant de la facture & N & integer \\
\hline
PAYMENT\_ID & Identifiant du paiement & N & integer \\
\hline
AMOUNT & Montant de la transaction & N & float \\
\hline
ENTRY\_DATE & Date d'insertion de l'enregistrement & N & timestamp \\
\hline
\end{tabular}

\paragraph{CIVILITY\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
CIVILITY\_ID & Identifiant de la civilit\'e & N & integer \\
\hline
SHDES & Short description & N & varchar(10) \\
\hline
DESCRIPTION & Description & N & varchar(100) \\
\hline
\end{tabular}

\paragraph{CONDITIONS\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
CONDITION\_ID & Condition identification & N & integer \\
\hline
CONDITION\_TYPE & Condition d'admission (A), condition de sortie (E) & N & varchar(10) \\
\hline
CONDITION\_DESC & Description de la condition & N & varchar(250) \\
\hline
ARGS & D\'efinition des arguments et valeurs pour \'evaluer la condition & N & varchar(300) \\
\hline
SHDES & Descripteur court de la condition & N & varchar(10) \\
\hline
DES & Description & N & varchar(100) \\
\hline
VALID & True: if the XML condition desc is valid. False if not. & N & boolean \\
\hline
\end{tabular}

\paragraph{CONTRACT\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
CONTRACT\_REF & R\'ef\'erence externe du contrat & N & varchar(100) \\
\hline
CUSTOMER\_REF & R\'ef\'erence externe du client poss\'edant le contrat & N & varchar(100) \\
\hline
CUSTOMER\_ID & Identifiant du client & N & integer \\
\hline
CONTRACT\_ID & Identifiant du contrat & N & integer \\
\hline
CONTRACT\_SEQ & Num\'ero de s\'equence r\'epertoriant les changements de propri\'etaires du contrat & N & integer \\
\hline
ENTRY\_DATE & Date d'insertion de l'enregistrement & N & timestamp \\
\hline
STATUS & Statut du contrat. FK status\_reasons & N & integer \\
\hline
\end{tabular}

\paragraph{CONTRACT\_HISTORY\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
CONTRACT\_ID & Identifiant du contrat & N & integer \\
\hline
CONTRACT\_SEQ & Num\'ero de s\'equence r\'epertoriant les changements d'\'etat du contrat & N & integer \\
\hline
ENTRY\_DATE & Date d'insertion de l'enregistrement & N & timestamp \\
\hline
MOD\_DATE & Date r\'eelle de changement d'\'etat du contrat & N & timestamp \\
\hline
STATUS & Etat du contrat. (a): actif, (s): suspendu, (d): d\'esactiv\'e & N & varchar(5) \\
\hline
\end{tabular}

\paragraph{CONTRACT\_RESOURCES\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
CONTRACT\_ID & Identifiant du contrat & N & integer \\
\hline
RESOURCE\_NUMBER & Identifiant de la ressource. MSISDN, num\'ero de la ligne \ldots & N & varchar(100)\\
\hline
ENTRY\_DATE & Date d'enregistrement de la ressource dans la table CONTRACT\_RESOURCES & N & timestamp \\
\hline
MOD\_DATE & Date de changement d'\'etat & N & timestamp \\
\hline
SEQ & Num\'ero de s\'equence pour l'historique des changements d'\'etats de la ressource & N & integer \\
\hline
RESOURCE\_STATUS & Etat de la resource. (a): actif, (s): suspendu, (d): d\'esactiv\'e & N & varchar(5) \\
\hline
\end{tabular}

% # A TERMINER

Cette table est un instantan\'e du client.
\paragraph{CUSTOMER\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type\\
\hline
CATEGORY & Identifiant de la cat\'egorie de client & N & integer \\
\hline
STATUS & Etat du client. (a): actif, (s): suspendu, (d): d\'esactiv\'e & N & varchar(5) \\
\hline
CURRENT\_STEP & FK vers l'\'etape courante du client & N & integer \\
\hline
STEP\_DELAY & Dur\'ee de l'\'etape en jours. & N & integer \\
\hline
STEP\_ENTRY\_DATE & Date de l'entr\'ee en recouvrement du client & N & timestamp \\
\hline
CUSTOMER\_ID & Identifiant du client & N & integer \\
\hline
NEXT\_STEP & FK vers l'\'etape suivante du client & N & integer \\
\hline
OPENAMOUNT & Solde courant d\^u & N & float \\
\hline
OPENAMOUNT\_DUNNING & Solde d\^u en recouvrement & N & float \\
\hline
OPENAMOUNT\_DUNNING\_NOCONFLICT & Solde d\^u en recouvrement hors-litige & N & integer \\
\hline
COMPUT\_MODE & Mode de calcul des modes. 'E': Estimation, 'C': Calcul\'e par le module de traitement & N & varchar(1) \\
\hline
COMPUT\_DATE & Date de calcul des soldes. & N & timestamp \\
\hline
\end{tabular}

\paragraph{CUSTOMER\_CATEGORY\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
CUST\_CAT\_ID & Identifiant de la cat\'egorie de client & N & integer \\
\hline
SHDESC & Descripteur court de la cat\'egorie de client & N & varchar(10)\\
\hline
DESCRIPTION & Description de la cat\'egorie de client & N & varchar(100) \\
\hline
\end{tabular}

\paragraph{CUSTOMER\_DELAY\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
CUST\_CAT\_ID & Identifiant de la cat\'egorie de client & N & integer \\
\hline
STEP\_ID & Identifiant d'une \'etape & N & integer \\
\hline
DELAY & Nombre de jours ajout\'es \`a la date d'entr\'ee en \'etape pour le r\'eglement de la facture & N & integer \\
\hline
\end{tabular}

\paragraph{CUSTOMER\_DETAIL\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
CUSTOMER\_ID & Identifiant de la cat\'egorie de client & N & integer \\
\hline
CUSTOMER\_REF & R\'ef\'erence externe du client & N & varchar(100) \\
\hline
NAME & Nom du client & N & varchar(250) \\
\hline
SURNAME & Pr\'enom du client & N & varchar(250) \\
\hline
OTHER\_SURNAME & Autres pr\'enoms du client & N & varchar(250) \\
\hline
CIVILITY & Civilit\'e du client & N & varchar(5) \\
\hline
PHONE1 & Num\'ero de t\'el\'ephone du client & N & varchar(50) \\
\hline
PHONE2 & Num\'ero de t\'el\'ephone du client & O & varchar(50) \\
\hline
FAX & Num\'ero de fax du client & O & varchar(50) \\
\hline
E\_MAIL & Adresse e-mail du client & O & varchar(150) \\
\hline
STREET\_NUMBER & Street number & N & varchar(10) \\
\hline
STREET\_EXT & Street extension & N & varchar(5) \\
\hline
STREET\_NAME & Street name & N & varchar(150) \\
\hline
ZIP\_CODE & Code zip de l'adresse & N & varchar(10) \\
\hline
TOWN & Ville & N & varchar(50) \\
\hline
STATE & State & N & varchar(50) \\
\hline
COUNTRY & Name of the customer's country & N & varchar(100) \\
\hline
RESPONSIBLE & The ADAMA user responsible of the customer & N & varchar(100) \\
\hline
SEQ\_DETAIL & The sequence number of the record for the customer & N & integer \\
\hline
LAST\_MOD\_USER & Last ADAMA user that has modified the record & N & varchar(30) \\
\hline
BALANCE & Customer balance & Y & Float \\
\hline
\end{tabular}

Cette table conserve l'historique des \'etats du clients.
\paragraph{CUSTOMER\_HISTORY\\}
\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
CUSTOMER\_ID & Identifiant du client & N & integer \\
\hline
STATUS & Etat du client. (a): actif, (s): suspendu, (d): d\'esactiv\'e & N & varchar(5) \\
\hline
REASON & Reason of the status. FK to REASON\_STATUS.REASON\_ID & N & integer \\
\hline
SEQ & Status sequence number & N & integer \\
\hline
ENTRY\_DATE & Date d'insertion de l'enregistrement & N & timestamp \\
\hline
MOD\_DATE & Date r\'eelle de changement d'\'etat du client & N & timestamp \\
\hline
\end{tabular}

Cette table contient l'ensemble des \'etaes travers\'ees par le client ainsi que le statut des actions appliqu\'ees au client.
\paragraph{CUSTOMER\_PATH\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
CUSTOMER\_ID & Identifiant du client & N & integer \\
\hline
STEP\_ID & Etape du client & N & integer \\
\hline
ACTION\_ID & Action appliqu\'ee au client & N & integer \\
\hline
SEQ & S\'equence qui s'incr\'emente pour un client, une \'etape et une action donn\'es & N & integer \\
\hline
ENTRY\_DATE & Date d'insertion de la ligne & N & timestamp \\
\hline
REFERENCE\_DATE\_STEP & Date de r\'ef\'erence d'entr\'ee dans l'\'etape. Cette date est modifi\'ee lors du r\'eactivation du client dans le cycle de r\'eactivation. & N & timestamp \\
\hline
REFERENCE\_DATE\_ACTION & Date de r\'ef\'erence de d\'ebut d'action. & N & timestamp \\
\hline
DONE & Flag indiquant si l'action a \'et\'e r\'ealis\'ee. Oui (Y), Non (N) & N & varchar(5) \\
\hline
\end{tabular}

\paragraph{CYCLES\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
CYCLE\_ID & Identifiant du cycle & N & integer \\
\hline
DESCRIPTION & Description du cycle & N & varchar(250)\\
\hline
INIT\_STEP & Initial step short description. FK to STEPS.SHDES & N & varchar(10) \\
\hline
\end{tabular}

\paragraph{DUNNING\_LETTER\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
LETTER\_ID & Identifiant de la lettre & N & integer \\
\hline
CUSTOMER\_ID & Identifiant du client & N & integer \\
\hline
CO\_ID & Identifiant du contrat & N & integer \\
\hline
LETTER\_BODY & Contenu de la lettre & N & varchar(300) \\
\hline
\end{tabular}

\paragraph{EXPORT\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
EXPORT\_ID & Identifiant de l'export & N & integer \\
\hline
EXPORT\_NAME & Nom de l'export & N & varchar(100) \\
\hline
BODY & Code SQL de l'export & N & varchar(500)\\
\hline
PARAMS & Param\`etres de l'export & N & varchar(200)\\
\hline
VERSION & version de l'export & N & integer \\
\hline
VSDATE & Date de la version & N & timestamp \\
\hline
FILE\_ID & R\'ef\'erence vers le nom du fichier d'export & O & integer \\
\hline
\end{tabular}

\paragraph{EXPORT\_FILE\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
FILE\_ID & Identifiant du fichier g\'en\'er\'e & N & integer \\
\hline
EXPORT\_ID & Identifiant de l'export. FK vers EXPORT.EXPORT\_ID & N & integer \\
\hline
FILE\_NAME & Nom du fichier g\'en\'er\'e & N & varchar(250)\\
\hline
ENTDATE & Date d'insertion de l'enregistrement & N & timestamp \\
\hline
\end{tabular}

\paragraph{EXPORT\_CUSTOMER\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
CUSTOMER\_ID & Identifiant du client & N & integer \\
\hline
FILE\_ID & Identifiant du fichier export\'e & N & integer \\
\hline
\end{tabular}

\paragraph{FALLING\_DUES\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
FALLING\_DUE\_ID & Identifiant de l'\'ech\'eancier & N & integer \\
\hline
INVOICE\_ID & Identifiant de la facture du client & N & integer \\
\hline
AMOUNT & Montant de l'\'ech\'eancier & N & float \\
\hline
DUE\_DATE & Ech\'eance de l'\'ech\'eancier & N & timestamp \\
\hline
STATUS & Etat de l'\'ech\'eancier. 'U': Impay\'e, 'P': Pay\'e & N & timestamp \\
\hline
\end{tabular}

\paragraph{FEES\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
CUSTOMER\_ID & Identifiant du client & N & integer \\
\hline
FEE\_ID & Identifiant du surco\^ut & N & integer \\
\hline
INIT\_AMOUNT & Montant initial du surco\^ut H.T. factur\'e au client & N & varchar(500) \\
\hline
OPEN\_AMOUNT & Montant ouvert du surco\^ut H.T. factur\'e au client & N & varchar(500) \\
\hline
ENTDATE & Date d'insertion de l'enregistrement & N & timestamp \\
\hline
MODDATE & Date de mise \`a jour de l'enregistrement & N & timestamp \\
\hline
\end{tabular}

\paragraph{FEES\_PARAM\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
FEE\_ID & Identifiant du surco\^ut H.T. & N & integer \\
\hline
CUST\_CAT\_ID & Identifiant de la cat\'egorie de client & N & integer \\
\hline
STEP\_ID & Identifiant d'une \'etape & N & integer \\
\hline
ACTION\_ID & Identifiant de l'action & N & integer \\
\hline
DESC & Description du surco\^ut & N & varchar(250) \\
\hline
AMOUNT & Montant du surco\^ut H.T. factur\'e au client & N & varchar(500) \\
\hline
PARAMS & Param\`etres du champ amount & Y & varchar(200)\\
\hline
VSCODE & Code de version du surcout & N & integer \\
\hline
\end{tabular}

\paragraph{INOUT\_STATS\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
FILENAME & Nom du fichier trait\'e & N & varchar(100) \\
\hline
EXCHANGE\_TYPE & Type d'\'echange (import ou export d'item). I: Import, E: Export & N & varchar(2) \\
\hline
NB\_ITEMS\_OK & Nombre d'items trait\'es correctement & N & integer \\
\hline
NB\_ITEMS\_KO & Nombre d'items trait\'es en erreur & N & integer \\
\hline
PROCESS\_LAST & Dur\'ee du process du fichier en secondes & N & integer \\
\hline
\end{tabular}

\paragraph{INVOICE\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
INVOICE\_ID & Identifiant de la facture & N & integer \\
\hline
CUSTOMER\_REF & R\'ef\'erence du client rattach\'ee \`a la facture & N & varchar(100) \\
\hline
CUSTOMER\_ID & Identifiant du client rattach\'ee \`a la facture & N & integer \\
\hline
INVOICE\_REF & R\'ef\'erence de la facture & N & varchar(50) \\
\hline
DUE\_DATE & Date d'\'ech\'eance de la facture. & N & timestamp \\
\hline
DUN\_ENTRY\_DATE & Date d'entr\'ee en recouvrement de la facture. & N & timestamp \\
\hline
INITIAL\_OPEN\_AMOUNT & Montant initial d\^u. & N & float \\
\hline
OPEN\_AMOUNT & Montant d\^u. & N & float \\
\hline
LITIGIOUS\_INVOICE & Facture litigieuse (Y/N). & N & bool \\
\hline
TYPE & IN: Invoice, CN: Credit Note & N & varchar(3) \\
\hline
\end{tabular}

\paragraph{PAYMENTS\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
PAYMENT\_ID & Identifiant du paiement & N & integer \\
\hline
PAYMENT\_REF & R\'ef\'erence du paiement & N & varchar(100) \\
\hline
CUSTOMER\_REF & R\'ef\'erence du client rattach\'e \`a la facture & N & varchar(100) \\
\hline
CUSTOMER\_ID & Identifiant du client rattach\'e \`a la facture & N & integer \\
\hline
AMOUNT & Montant de la transaction & N & float \\
\hline
ENTRY\_DATE & Date d'insertion de l'enregistrement & N & timestamp \\
\hline
TYPE & D: paiement entrant, C: paiement rejet\'e & N & varchar(3) \\
\hline
\end{tabular}

\paragraph{PROC\_STOCK\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
PS\_ID & Identifiant de la proc\'edure stock\'ee & N & integer \\
\hline
PS\_NAME & Nom de la proc\'edure stock\'ee & N & varchar(100) \\
\hline
PARAMS & Param\`etres de l'export & N & varchar(200)\\
\hline
VERSION & version de l'export & N & integer \\
\hline
VSDATE & Date de la version & N & timestamp \\
\hline
VSCODE & Code de la version & N & integer \\
\hline
\end{tabular}

\paragraph{REASON\_STATUS\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
REASON\_ID & Reason id. & N & integer \\
\hline
STATUS & Status associated to the reason & N & varchar(2) \\
\hline
REASON\_DESC & Reason description & N & varchar(100) \\
\hline
\end{tabular}

\paragraph{REF\_SEQ\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
FILE\_ID & Identifiant du fichiers & N & integer \\
\hline
FILE & Pr\'efixe du fichier d'import & N & varchar(500) \\
\hline
SEQ\_NUMBER & Num\'ero de s\'equence du fichier trait\'e & N & integer \\
\hline
DIRECTORY & R\'epertoire contenant le fichier \`a importer & N & varchar(1000) \\
\hline
STATUS & Flag indiquant si l'import du fichier doit \^etre r\'ealis\'e & N & varchar(1) \\
\hline
\end{tabular}

\paragraph{RESOURCE\_SERVICES\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
ID\_CONTRACT & Identifiant du contrat & N & integer \\
\hline
CONTRACT\_SEQ & Num\'ero de s\'equence r\'epertoriant les changements d'\'etat du contrat & N & integer \\
\hline
RESOURCE\_NUMBER & Identifiant de la ressource. MSISDN, num\'ero de la ligne \ldots & N & varchar(100)\\
\hline
SHDESC\_SERVICE & Descripteur court du service & N & varchar(10) \\
\hline
SERVICE\_PARAM & Param\`etres du service & N & varchar(100) \\
\hline
DATE\_ACTIVATION & Date d'activation du service. & N & timestamp \\
\hline
DATE\_DEACTIVATION & Date de d\'esactivation du service. & N & timestamp \\
\hline
ENTRY\_DATE & Date d'insertion de l'enregistrement & N & timestamp \\
\hline
\end{tabular}

\paragraph{SMS\\}
\label{paragraph:tablesms}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
ID\_SMS & Identifiant du message & N & integer \\
\hline
SHDESC & Descripteur court & N & varchar(10) \\
\hline
CONTENU & Contenu du SMS. Chaque partie variable du message est remplac\'ee par le caract\`ere \% & N & varchar(500) \\
\hline
VALUE1 & Valeur du $1^\mathrm{er}$ argument. & O & varchar(1000) \\
\hline
VALUE2 & Valeur du $2^\mathrm{\grave{e}me}$ argument. & O & varchar(1000) \\
\hline
VALUE3 & Valeur du $3^\mathrm{\grave{e}me}$ argument. & O & varchar(1000) \\
\hline
VALUE4 & Valeur du $4^\mathrm{\grave{e}me}$ argument. & O & varchar(1000) \\
\hline
VALUE5 & Valeur du $5^\mathrm{\grave{e}me}$ argument. & O & varchar(1000) \\
\hline
VALUE6 & Valeur du $6^\mathrm{\grave{e}me}$ argument. & O  & varchar(1000) \\
\hline
VALUE7 & Valeur du $7^\mathrm{\grave{e}me}$ argument. & O & varchar(1000)  \\
\hline
VALUE8 & Valeur du $8^\mathrm{\grave{e}me}$ argument. & O  & varchar(1000) \\
\hline
VALUE9 & Valeur du $9^\mathrm{\grave{e}me}$ argument. & O & varchar(1000)  \\
\hline
VALUE10 & Valeur du $10^\mathrm{\grave{e}me}$ argument. & O & varchar(1000)  \\
\hline
\end{tabular}

\paragraph{SMS\_ETAPE\\}

\begin{tabular}{|p{5cm}|p{8cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
ID\_ETAPE & Identifiant de l'\'etape & N & integer \\
\hline
ID\_SMS & Identifiant du SMS. Cl\'e \'etrang\`ere vers SMS.ID\_SMS & N & integer \\
\hline
CAT\_CUSTOMER & Cat\'egorie de client qui re{\c c}oit le SMS. FK vers CUSTOMER\_CATEGORY.ID\_CUST\_CAT & N & integer \\
\hline
\end{tabular}

\paragraph{SOAP\_OUT\_STREAMS\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
STREAM\_ID & Stream identification. & N & integer \\
\hline
BODY & XML body & N & varchar(10000) \\
\hline
PARAMETERS & Stream parameters & N & varchar(200) \\
\hline
VERSION & Stream version & N & integer \\
\hline
VSDATE & Version date & N & timestamp \\
\hline
STREAM\_NAME & Stream name & N & varchar(100) \\
\hline
\end{tabular}

\paragraph{STATUS\_REASONS\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
STATUS\_ID & Status identification. & N & integer \\
\hline
SHDES & Short description of the status & N & varchar(10) \\
\hline
DESCRIPTION & Description of the status & N & varchar(100) \\
\hline
\end{tabular}

\paragraph{STEP\_CONDITION\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
STEP\_ID & Step identification. FK to STEPS.STEP\_ID & N & integer \\
\hline
CONDITION\_ID & Condition identification. FK to CONDITIONS.CONDITION\_ID  & N & integer \\
\hline
\end{tabular}

\paragraph{STEPS\\}

\begin{tabular}{|p{5cm}|p{7cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
STEP\_ID & Identifiant de l'\'etape & N & integer \\
\hline
SHDES & Descripteur court de l'\'etape & N & varchar(10) \\
\hline
PRIORITY & Step priority & N & integer \\
\hline
DESCRIPTOR & Libell\'e de l'\'etape. & N & varchar(250) \\
\hline
DURATION & Dur\'ee de l'\'etape en jours & N & integer \\
\hline
STATUS & Statut de l'\'etape. Active (a), D\'esactiv\'ee (d) & N & varchar(5) \\
\hline
CONDITION\_ID & FK vers CONDITIONS & N & integer \\
\hline
ARGS & D\'efinition des arguments et valeurs pour \'evaluer la condition & N & varchar(300) \\
\hline
PREV\_STEP\_ID & Identifiant de l'\'etape pr\'ec\'edente & O & integer \\
\hline
PHASE & Phase de l'\'etape. I: Etape initiale, F: Etape finale, N: Etape interm\'ediaire & N & varchar(1) \\
\hline
\end{tabular}

\paragraph{TICKLERS\\}

\begin{tabular}{|p{5cm}|p{8cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
TICKLER\_ID & Identifiant du tickler & N & integer \\
\hline
SHDESC & Descripteur court du tickler & N & varchar(10) \\
\hline
TYPE & Type of tickler: INFO, ACTION & N & varchar(10) \\
\hline
E\_MAIL & E-mail list of the vendors & N & varchar(250) \\
\hline
CONTENT & Contenu du tickler & N & varchar(500) \\
\hline
\end{tabular}

\paragraph{TICKLER\_RECORDS\\}

\begin{tabular}{|p{5cm}|p{8cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
TICKLER\_REC\_ID & Tickler record id. & N & integer \\
\hline
TICKLER\_ID & FK to TICKLERS.TICKLER\_ID & N & integer \\
\hline
SHDES & Descripteur court du tickler & N & varchar(10) \\
\hline
STATUS & Statut du tickler: NOTE, OPEN, CLOSED, INPROCESS & N & varchar(10) \\
\hline
CUSTOMER\_ID & Identifiant du client concern\'e par le tickler & N & varchar(10) \\
\hline
CONTRACT\_ID & Identifiant du contrat concern\'e par le tickler & N & varchar(10) \\
\hline
CONTENT & Contenu du tickler & N & varchar(500) \\
\hline
ENTRY\_DATE & Date d'insertion de l'enregistrement & N & timestamp \\
\hline
MOD\_DATE & Date de modification de l'enregistrement & N & timestamp \\
\hline
RESPONSIBLE & CDC responsable du client & N & varchar(100) \\
\hline
\end{tabular}

\paragraph{URL\_REF\\}

\begin{tabular}{|p{5cm}|p{8cm}|p{1cm}|p{1.5cm}|}
\hline
Nom colonne & Description & Nulle (O/N) & Type \\
\hline
URL\_ID & URL id. & N & integer \\
\hline
URL\_VALUE & URL target & N & varchar(200) \\
\hline
URL\_DESCRIPTION & URL description & N & varchar(200) \\
\hline
\end{tabular}

\chapter{Codes retour d'ADAMA}

\chapter{Check lists}

\section{Comment cr\'eer les foonctions n\'ecessaires \`a la gestion des \'etapes}
Sous psql, appeler la fonction:
dropper step\_tree\_bkg;
dropper les rules associ\'ees \`a la table STEPS;
select \_tree\_create('step\_tree', 2,  'steps', 'step\_id');

Deleter la table STEPS pour la repeupler
Pour repeupler la vue step\_tree, lancer les scripts copy\_steps.sql et copy\_steps\_2.sql

\section{Comment param\'etrer une \'etape}

Pour g\'en\'erer le script ltmain.sh, lancer la commande libtoolize.
Pour g\'en\'erer aclocal.m4, lancer la commande aclocal.
Pour g\'en\'erer les autres fichiers, lancer la commande: automake -a.
Pour installer la libpqxx en mode dynamique, lancer le configure avec l'option --enable-shared.

Compilation ADAMA:
./configure --enable-debug --enable-shared

A l'install de wxWidgets, ajouter l'option --enable-gui pour le configure afin d'activer la cr\'eation des Makefile dans le r\'epertoire contrib.
Aller ensuite dans le r\'epertoire contrib et make puis make install.

Pour compiler wxWidgets, consulter le fichier wxPython-x.y.z/wxPython/docs/BUILD.txt pour le configurer correctement.
A CONFIRMER
Le wxWidgets qu'il est necessaire d'installer est celui qui vient dans wxPython-x.y.z au dessus du sous-repertoire wxPython.

Pour compiler un binaire java en chargeant le driver PostGreSQL,
java -Djdbc.drivers=org.postgresql.Driver example.ImageViewer

javac -classpath /home/simon/ADAMA/Src/gui ADAMAConnection.java
java -Djdbc.drivers=org.postgresql.Driver -classpath /home/simon/ADAMA/Src/gui:/usr/local/pgsql/share/java/postgresql.jar cdc.ADAMAConnection

\paragraph{Installation de la base ademo}
Aller sur le r\'epertoire contenant un backup de la base:
cd ~/ADAMA/ademo\_backup/

Se connecter en tant que user postgresql,
psql -d postgres

Cr\'eer l'utilisateur adama sur la base ademo

\begin{verbatim}
postgres=# create user adama superuser password 'adama';
postgres=# create database ademo owner adama;
\end{verbatim}

Se d\'econnecter,
\begin{verbatim}
postgres=# \q
\end{verbatim}

Se reconnecter en tant que adama:
psql-d ademo -U adama
\begin{verbatim}
ademo=# \i adama_backup.sql
ademo=# commit
\end{verbatim}

Lorsqu'un 'svn update' est r\'ealis\'e, effectuer un mv de l'item mis \`a jour pour r\'ecup\'erer la bonne version (sinon svn ne remplace apparemment pas l'item).

\paragraph{Reste a faire}
\begin{enumerate}
\item module comptable avec import factures
\item module de gestion des paiements
\item definir les conditions d'admission et de sortie (OK)
\item comment gerer les PME, TPE ou Entreprises
\item verifier mise a jour de customer\_history lors de l'import des clients en base
\item g\'erer la p\'eriodicit\'e des actions de la table ACTION
\item migrer les map de vecteur pour l'export en objets a exporter avec pour attributs les maps. Chaque objet aura ses maps (remplies ou vides).
\item Pour la cr\'eation d'un client par l'interface Java, charger en base les villes, codes postaux et d\'epartements.
\item G\'erer la balance du client. En fin de cycle de traitement des clients ???.
\item G\'erer les colonnes reference\_date\_step et reference\_date\_action de la table customer\_path.
\item G\'erer de mani\`ere uniforme les arguments des exports/imports
\item Traiter coherence montant ouvert facture et \'ech\'eanciers
\item Changer le nom de la colonne next\_step\_id en prev\_step\_id
\item Revoir le moteur engine en fonction de la r\'eorganisation des conditions
\item Traiter l'affichage des ticklers comme les conditions dans AActionDisplay.cpp
\item Code Monitor dans le fichier Condition.cpp a integrer
\end{enumerate}

        Simon ELBAZ                8, rue Belgrand            92300 Levallois-Perret


Mob :    +336 14 99 02 78

E-mail : simon.elbaz@free.fr

N le 7 juillet 1975  Casablanca, mari, 2 enfants

Ingnieur du Dpartement Informatique et Mathmatiques Appliques de l'E.N.S.E.E.I.H.T (www.enseeiht.fr)

            Domaines d'activit

    Expertise fonctionnelle et technique des systmes de Billing pour les oprateurs tlcoms
    Validation, Recette
    Expertise technique ETL
    Analyse des besoins, conception et implmentations des solutions
    Utilisation avance des bases de donnes Oracle

Comptences fonctionnelles

    Billing, Collecte des tickets d'appels, Recouvrement, CRM
    Oprateurs Telecoms
    Revenue Management
    Permis de conduire
    Protocoles Internet, Web 2.0

Comptences  techniques

    Progiciels: BSCS, Kenan FX, Oracle BRM, Arbor BP, Talend, Datastage, Informatica, Zope3, Subversion, Telelogic Continuus, Siebel, Tuxedo, Valgrind, Insure++
    Bases de donnes : Oracle, Sybase, MySQL, Postgresql, SQLite
    OS : Linux, Unix, NT
    Langages : C/C++, Python, shell, PL/SQL, Pro*C, Perl, Java, Lex, Yacc
    Rseaux : SSL, IPv6

Rfrences principales

CAPGEMINI TELECOM MEDIA & NETWORKS France
	

Responsable Validation / Dveloppement chez Capgemini Telecom Media & Networks France
	

Tech Data, France
	

Stage de tlmarketing (6 semaines) chez Tech Data Corporation

Langues

    Anglais : courant (TOEIC : 740/990)
    Franais : langue maternelle

Exprience professionelle

Sept. 99  aujourd'hui    Responsable validation chez Cap Gemini Telecom France

Missions ralises
	

Janvier 2012  Prsent
	

Migration du SI des permis de conduire  points  lAgence Nationale des Titres Scuriss
	

        Participation  la phase dintgration de la migration du SNPC (ancien systme de gestion des permis de conduire) vers Faeton

        Rdaction du cahier de recette

        Suivi de lavancement de la validation  partir de Quality Center de HP
        Responsable de lquipe de validation (3 personnes)

	

Octobre 2011  Dcembre 2011
	

Revenue Management chez Air France  KLM
	

        Spcification et dveloppement au sein du projet Karma de Revenue Management chez Air France - KLM

        Traitement de lhistorique des rservations de billets Air France - KLM sur une priode de 3 ans : 2 milliards dvnements de booking de billets Air France  KLM traits en Perl et ETL Talend en moins de 3h 30 minutes

	

Aot 2011  Septembre 2011
	

Migration du SI de gestion des stocks des boutiques Orange
	

        Participation  la phase dintgration du progiciel Torex de gestion des stocks de boutiques dans le projet Bestar

        Participation  la phase dintgration de lETL Talend
        Responsable de lquipe de validation (2 personnes)

	

Mai 2010  Juillet 2011
	

Migration du SI mobile chez SFR, Grand Public
	

        Participation  la phase dintgration du progiciel de billing Oracle BRM dans le projet BIOS

        Participation  la phase dintgration de lETL Datastage
        Dveloppement dvolutions dans le domaine de la valorisation (pipeline BRM)
        Coaching dune quipe de 2 personnes

	

Aot 2009  Avril 2010
	

Upgrade progiciel de facturation, OS et base de donnes chez SFR, Entreprise
	

        Migration de la version Kenan BP 10.0 vers Kenan FX 12.0
        Migration de la chane de facturation vers le nouvel OS (Solaris 2.10) et Oracle 10g
        Utilisation de l'outil Comverse VUU pour extraire et convertir les donnes en base Kenan FX
        Tests des donnes migres et de non rgression

	

Juillet 2006  Juillet 2009
	

Fusion des systmes de facturation et CRM de SFR, Cegetel, 9Telecom, Club Internet, Tele2, Grand Public
	

        Migration des donnes du systme de facturation existant vers Kenan FX 11.0

        Migration des donnes du CRM existant vers Siebel 7.0

        Spcification des mthodes de migration
        Utilisation de l'outil LCU de Comverse pour convertir et charger les donnes dans une base Kenan BP
        Test des donnes migres
        Utilisation d'Informatica pour extraire et convertir les donnes dans des fichiers  destination de Kenan BP et Siebel

	

Juillet 2003  Mai 2006
	

Responsable fonctionnel de l'interface entre le CRM Siebel et le systme de billing BSCS chez SFR, Grand Public
	

    Responsable d'quipe (2 personnes)
    Validation de bout en bout: implmentation d'offres commerciales, valorisation d'appels, gnration de la facture papier
    Amlioration de la qualit du code avec Insure++
    Gestion des sources avec Continuus
    Utilisation du CAS (API BSCS)
    Dlais tendus de livraison des volutions
    Programmation C/C++, parser XML Xerces, utilisation de Lex & Yacc

	

Dcembre 2001  Juin 2003
	

Projet de recouvrement chez Bouygues Telecom
	

    Spcification et programmation

    Programmation C/C++ sous Windows NT, Visual C++

    Paramtrage du logiciel Ligis de Metamicro (www.metamicro.fr)

    Spcification et programmation

    Programmation C/C++ sous Windows NT, Visual C++

    Paramtrage du logiciel Ligis de Metamicro (www.metamicro.fr)

	

Septembre 2001  Novembre 2001
	

Projet de collecte des appels chez Noos
	

    Dveloppement bas sur Object Switch (Kabira) d'une interface de collecte du systme de mdiation VOIP de Noos
    Installation et validation de l'interface de collecte VOIP chez Noos
    Installation de softs ncessaires au fonctionnement de l'interface de collecte : Apache, PHP 

	

Octobre 1999  Septembre 2001
	Migration du systme de facturation existant vers BSCS, Maroc Telecom, Grand Public
	

    Paramtrage initial de BSCS

    Programmation et maintenance de l'interface de collecte ObjectSwitch (Kabira)

    Programmation de diffrents batchs en Pro*C dans les domaines suivants : comptabilit, recouvrement, roaming, offre commerciale

    Optimisation de requtes SQL en utilisant tkprof, les outils d'explain plan d'Oracle

	

Septembre 1999  Octobre 1999
	

Programmation de batches autour de BSCS chez Mobistar
	

    Programmation de batches Pro*C dans le domaine de la comptabilit


Cursus

1996-99        Elve ingnieur  l'ENSEEIHT dans le dpartement Informatique et Mathmatiques Appliques

1993-96        Classes prparatoires aux Grandes Ecoles en Mathmatiques et Physique, Chimie au Lyce Carnot, Paris

1993        Baccalaurat en Mathmatiques et Physique avec mention Bien au Lyce Lyautey1, Casablanca, Maroc

Centres d'intrts

Hobbies :

Natation, lecture

Levallois, le 4 juin 2012
\end{document}
